# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹ç™ºã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰

> ğŸ¤– **Geminiå‘ã‘ã®é‡è¦ãªæƒ…å ±**  
> ã“ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ã¯ã€AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆï¼ˆç‰¹ã«Google Geminiï¼‰ãŒã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ»ææ¡ˆã‚’è¡Œã†éš›ã®å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã—ã¦ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚
>
> **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã¨è¨­è¨ˆåŸå‰‡ï¼š**
>
> - **ä¾å­˜æ€§æ³¨å…¥ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Uber Fx
> - **ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³**: ã€Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å…¥ã‚Œã€å…·è±¡ï¼ˆstructï¼‰ã‚’è¿”ã™ã€
> - **å‘½åè¦å‰‡**: ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿åã«`Impl`ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼ˆä¾‹ï¼š`NewProductServiceImpl`ï¼‰
> - **DIãƒ‘ã‚¿ãƒ¼ãƒ³**: `fx.Annotate`ã¨`fx.As`ã§å…·è±¡å‹ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å¤‰æ›
>
> ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ»ææ¡ˆæ™‚ã¯ã€ã“ã‚Œã‚‰ã®åŸå‰‡ã‚’å¿…ãšéµå®ˆã—ã¦ãã ã•ã„ã€‚

## 1. åŸºæœ¬æ–¹é‡

### 1.1. ç›®çš„ã¨ä¾¡å€¤è¦³

- **å“è³ªé‡è¦–**: ã‚³ãƒ¼ãƒ‰ã®å“è³ªã€ä¿å®ˆæ€§ã€ä¸€è²«æ€§ã‚’å‘ä¸Šã•ã›ã€é•·æœŸçš„ãªé–‹ç™ºåŠ¹ç‡ã‚’è¿½æ±‚ã™ã‚‹ã€‚
- **ãƒãƒ¼ãƒ æˆé•·**: é–‹ç™ºè€…ã®æŠ€è¡“çš„æˆé•·ã‚’æ”¯æ´ã—ã€çŸ¥è­˜ã®å…±æœ‰ã‚’ä¿ƒé€²ã™ã‚‹
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¾¡å€¤**: æœ€çµ‚çš„ã«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¾¡å€¤ã‚’æä¾›ã™ã‚‹ã“ã¨ã‚’æœ€å„ªå…ˆã¨ã™ã‚‹

### 1.2. ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æŒ‡é‡

- **è¨€èª**: ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ã‚³ãƒ¡ãƒ³ãƒˆã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯æ—¥æœ¬èªã§çµ±ä¸€
- **å»ºè¨­çš„å§¿å‹¢**: å•é¡ŒæŒ‡æ‘˜æ™‚ã¯å¿…ãšæ”¹å–„æ¡ˆã¨ãã®ç†ç”±ã‚’ä½µè¨˜
- **å­¦ç¿’æ”¯æ´**: é–¢é€£ã™ã‚‹ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚„å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹ã‚’ç©æ¥µçš„ã«å…±æœ‰
- **å¿ƒç†çš„å®‰å…¨æ€§**: è³ªå•ã‚„è­°è«–ã‚’æ­“è¿ã—ã€å¤±æ•—ã‹ã‚‰å­¦ã¶æ–‡åŒ–ã‚’é†¸æˆ

## 2. ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

> ğŸ“‹ **ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚µãƒãƒªãƒ¼**  
> åŠ¹æœçš„ãªã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ‰‹æ³•ã‚’å®šç¾©ã€‚å„ªå…ˆåº¦ä»˜ãã®è¦³ç‚¹ã€æ§‹é€ åŒ–ã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆæ‰‹æ³•ã€ãƒã‚¸ãƒ†ã‚£ãƒ–ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®é‡è¦æ€§ã‚’èª¬æ˜ã—ã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯å˜ãªã‚‹å“è³ªãƒã‚§ãƒƒã‚¯ã§ã¯ãªãã€çŸ¥è­˜å…±æœ‰ã¨ãƒãƒ¼ãƒ å­¦ç¿’ã®è²´é‡ãªæ©Ÿä¼šã§ã™ã€‚ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼ã¯æ•™å¸«ã¨ã—ã¦ã€ãƒ¬ãƒ“ãƒ¥ã‚¤ãƒ¼ã¯å­¦ç¿’è€…ã¨ã—ã¦ã€äº’ã„ã«æˆé•·ã§ãã‚‹å ´ã«ã—ã¾ã™ã€‚åŠ¹æœçš„ãªãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªå‘ä¸Šã ã‘ã§ãªãã€ãƒãƒ¼ãƒ å…¨ä½“ã®æŠ€è¡“åŠ›åº•ä¸Šã’ã«ã‚‚å¯„ä¸ã—ã¾ã™ã€‚

### 2.1. ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å„ªå…ˆé †ä½

ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã¯ç„¡æ•°ã®æ”¹å–„ç‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ãŒã€ã™ã¹ã¦ã‚’åŒã˜é‡è¦åº¦ã§æ‰±ã†ã¨ã€æœ¬è³ªçš„ãªå•é¡ŒãŒè¦‹è½ã¨ã•ã‚ŒãŒã¡ã§ã™ã€‚ä»¥ä¸‹ã®å„ªå…ˆé †ä½ã«å¾“ã£ã¦ã€é‡è¦ãªå•é¡Œã‹ã‚‰é †ã«å–ã‚Šçµ„ã¿ã¾ã™ï¼š

ä»¥ä¸‹ã®è¦³ç‚¹ã‚’**å„ªå…ˆåº¦é †**ã§è©•ä¾¡ã—ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚

| å„ªå…ˆåº¦ | è¦³ç‚¹ | ãƒã‚§ãƒƒã‚¯é …ç›®ä¾‹ | å½±éŸ¿ç¯„å›² |
| :---: | :--- | :--- | :--- |
| **ğŸ”´ æœ€é«˜** | **Correctness (æ­£ç¢ºæ€§)** | ä»•æ§˜ã‚’æº€ãŸã—ã¦ã„ã‚‹ã‹ï¼Ÿãƒã‚°ã‚„ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã¯è€ƒæ…®ã•ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ç›´çµ |
| **ğŸŸ  é«˜** | **Security (ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)** | SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ç­‰ã®è„†å¼±æ€§ã¯ãªã„ã‹ï¼Ÿå…¥åŠ›å€¤ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯é©åˆ‡ã‹ï¼Ÿ | ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ |
| **ğŸŸ¡ ä¸­é«˜** | **Performance (ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹)** | éåŠ¹ç‡ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ãªã„ã‹ï¼ŸN+1å•é¡Œã‚„ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã¯ãªã„ã‹ï¼Ÿ | ã‚·ã‚¹ãƒ†ãƒ æ€§èƒ½ |
| **ğŸ”µ ä¸­** | **Maintainability (ä¿å®ˆæ€§)** | è²¬å‹™ã¯é©åˆ‡ã«åˆ†é›¢ã•ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿå°†æ¥ã®å¤‰æ›´ã¯å®¹æ˜“ã‹ï¼Ÿè¤‡é›‘åº¦ã¯é©åˆ‡ã‹ï¼Ÿ | é–‹ç™ºåŠ¹ç‡ |
| **ğŸŸ¢ ä½** | **Readability (å¯èª­æ€§)** | å‘½åã¯é©åˆ‡ã‹ï¼Ÿãƒ­ã‚¸ãƒƒã‚¯ã¯è¿½ã„ã‚„ã™ã„ã‹ï¼Ÿã‚³ãƒ¡ãƒ³ãƒˆã¯å¿…è¦ååˆ†ã‹ï¼Ÿ | é–‹ç™ºè€…ä½“é¨“ |
| **âšª æœ€ä½** | **Consistency (ä¸€è²«æ€§)** | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã‚„è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã«æº–æ‹ ã—ã¦ã„ã‚‹ã‹ï¼Ÿ | ã‚³ãƒ¼ãƒ‰çµ±ä¸€æ€§ |

### 2.2. ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®ç€çœ¼ç‚¹

#### ğŸ¯ ç‰¹ã«æ³¨ç›®ã™ã¹ããƒã‚¤ãƒ³ãƒˆ

- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ä¾‹å¤–çš„ãªã‚±ãƒ¼ã‚¹ã§ã®å‹•ä½œã¯å®‰å…¨ã‹ï¼Ÿ
- **ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†**: DBæ¥ç¶šã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒ³ãƒ‰ãƒ«ã€goroutineã®é©åˆ‡ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- **ä¸¦è¡Œå‡¦ç†**: ãƒ‡ãƒ¼ã‚¿ç«¶åˆã‚„ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã®å¯èƒ½æ€§ã¯ãªã„ã‹ï¼Ÿ
- **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: ãƒ¢ãƒƒã‚¯ã‚„ã‚¹ã‚¿ãƒ–ãŒä½¿ã„ã‚„ã™ã„è¨­è¨ˆã«ãªã£ã¦ã„ã‚‹ã‹ï¼Ÿ

## 3. åŠ¹æœçš„ãªãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã®æ›¸ãæ–¹

> ğŸ“‹ **ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚µãƒãƒªãƒ¼**  
> å»ºè¨­çš„ã§å®Ÿç”¨çš„ãªãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã®ä½œæˆæ–¹æ³•ã€‚STARãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹æ§‹é€ åŒ–ã€é‡è¦åº¦ã®æ˜ç¤ºã€å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹ã®æä¾›ã‚’é€šã˜ã¦ã€çœŸã«ä¾¡å€¤ã‚ã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã¯ã€ç›¸æ‰‹ã«è¡Œå‹•ã‚’ä¿ƒã™é‡è¦ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚å˜ãªã‚‹æŒ‡æ‘˜ã§ã¯ãªãã€ç›¸æ‰‹ã®ç†è§£ã‚’æ·±ã‚ã€å…·ä½“çš„ãªæ”¹å–„è¡Œå‹•ã«ã¤ãªãŒã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¿ƒãŒã‘ã¾ã™ã€‚åŠ¹æœçš„ãªã‚³ãƒ¡ãƒ³ãƒˆã¯ã€å³åº§ã«å•é¡Œã‚’è§£æ±ºã™ã‚‹ã ã‘ã§ãªãã€å°†æ¥çš„ã«åŒæ§˜ã®å•é¡Œã‚’é¿ã‘ã‚‹å­¦ç¿’åŠ¹æœã‚‚ç”Ÿã¿å‡ºã—ã¾ã™ã€‚

### 3.1. é‡è¦åº¦ã®æ˜ç¤ºã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®æ˜ç¢ºåŒ–

ã‚³ãƒ¡ãƒ³ãƒˆã‚’å—ã‘ã‚‹å´ãŒé©åˆ‡ãªå„ªå…ˆé †ä½ã§å¯¾å¿œã§ãã‚‹ã‚ˆã†ã€é‡è¦åº¦ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ˜ç¢ºã«ç¤ºã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é™ã‚‰ã‚ŒãŸæ™‚é–“ã®ä¸­ã§æœ€ã‚‚åŠ¹æœçš„ãªæ”¹å–„ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ï¼š

ã‚³ãƒ¡ãƒ³ãƒˆã«ã¯é‡è¦åº¦ã¨å¿…è¦ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ˜è¨˜ã—ã€é–‹ç™ºè€…ãŒå„ªå…ˆé †ä½ã‚’åˆ¤æ–­ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

| é‡è¦åº¦ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | å¯¾è±¡ä¾‹ | ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ |
| :---: | :--- | :--- | :--- |
| **ğŸ”´ CRITICAL** | **ãƒãƒ¼ã‚¸å‰ã«å¿…é ˆä¿®æ­£** | ãƒã‚°ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã€ãƒ‡ãƒ¼ã‚¿ç ´æãƒªã‚¹ã‚¯ | å³åº§ |
| **ğŸŸ  HIGH** | **ãƒãƒ¼ã‚¸å‰ã®ä¿®æ­£ã‚’å¼·ãæ¨å¥¨** | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œã€ä¿å®ˆæ€§ã®å•é¡Œ | 24æ™‚é–“ä»¥å†… |
| **ğŸŸ¡ MEDIUM** | **æ¬¡å›ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ä¿®æ­£** | ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã€ãƒ†ã‚¹ãƒˆè¿½åŠ  | 1é€±é–“ä»¥å†… |
| **ğŸŸ¢ LOW** | **æ™‚é–“ã®ã‚ã‚‹ã¨ãã«ä¿®æ­£** | å‘½åæ”¹å–„ã€ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ  | ãƒãƒƒã‚¯ãƒ­ã‚° |
| **ğŸ”µ INFO** | **æƒ…å ±æä¾›ãƒ»è³ªå•** | ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ç´¹ä»‹ã€ä»£æ›¿æ‰‹æ³•ã®ææ¡ˆ | - |

### 3.2. åŠ¹æœçš„ãªã‚³ãƒ¡ãƒ³ãƒˆã®æ§‹é€ 

ã‚³ãƒ¡ãƒ³ãƒˆã¯ä»¥ä¸‹ã®**STARãƒ¡ã‚½ãƒƒãƒ‰**ã§æ§‹æˆã™ã‚‹ã€‚

```

ğŸ¨ **[SEVERITY] çŠ¶æ³ (Situation)**
ğŸ” **åŸå›  (Task/Problem)**
ğŸ“ **ææ¡ˆ (Action)**
ğŸ† **æœŸå¾…ã•ã‚Œã‚‹çµæœ (Result)**

```

#### æ‚ªã„ä¾‹ï¼šæŒ‡æ‘˜ã®ã¿

```

ã“ã®å¤‰æ•°åã¯åˆ†ã‹ã‚Šã«ãã„ã€‚

```

#### è‰¯ã„ä¾‹ï¼šSTARãƒ¡ã‚½ãƒƒãƒ‰é©ç”¨

```

ğŸ¨ **[LOW] å¤‰æ•°åã®å¯èª­æ€§å•é¡Œ**
å¤‰æ•° `d` ãŒä½•ã‚’è¡¨ã—ã¦ã„ã‚‹ã®ã‹ãŒä¸€ç›®ã§ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚

ğŸ” **åŸå› **
çŸ­ã„ç•¥è¨˜åã¯ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ã‚’ä¸‹ã’ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆã‚’å¢—åŠ ã•ã›ã¾ã™ã€‚

ğŸ“ **ææ¡ˆ**

```go
// Before
d := time.Since(startTime)

// After
elapsedTimeInSeconds := time.Since(startTime)
```

ğŸ† **æœŸå¾…ã•ã‚Œã‚‹çµæœ**
ã‚³ãƒ¼ãƒ‰ã®æ„å›³ãŒæ˜ç¢ºã«ãªã‚Šã€æ–°ã—ã„ãƒ¡ãƒ³ãƒãƒ¼ã§ã‚‚ç†è§£ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

```

### 3.3. ã‚³ãƒ¼ãƒ‰ä¾‹ã¨ãƒªã‚½ãƒ¼ã‚¹ã®æä¾›

#### ã‚³ãƒ¼ãƒ‰ä¾‹ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **Before/Afterå½¢å¼**: ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã¨æ”¹å–„å¾Œã®ã‚³ãƒ¼ãƒ‰ã‚’ä¸¦ã¹ã¦è¡¨ç¤º
2. **å®Ÿè¡Œå¯èƒ½ãªã‚³ãƒ¼ãƒ‰**: ã‚³ãƒ”ãƒ¼ï¼†ãƒšãƒ¼ã‚¹ãƒˆã§ã™ãã«è©¦ã›ã‚‹ã‚ˆã†ã«
3. **ã‚³ãƒ¡ãƒ³ãƒˆä»˜ã**: é‡è¦ãªéƒ¨åˆ†ã«ã¯èª¬æ˜ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 

#### å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹ã®æä¾›

ã‚³ãƒ¡ãƒ³ãƒˆã«ã¯é–¢é€£ã™ã‚‹å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹ã‚’ç©æ¥µçš„ã«å«ã‚ã‚‹ã€‚

- **å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: Goã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„Effective Goã¸ã®ãƒªãƒ³ã‚¯
- **ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹è¨˜äº‹**: ä¿¡é ¼ã§ãã‚‹æŠ€è¡“ãƒ–ãƒ­ã‚°ã‚„æ›¸ç±ã¸ã®å‚ç…§
- **å†…éƒ¨ãƒªã‚½ãƒ¼ã‚¹**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®é–¢é€£ã‚³ãƒ¼ãƒ‰ã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¸ã®ãƒªãƒ³ã‚¯

### 3.4. ãƒã‚¸ãƒ†ã‚£ãƒ–ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®å®Ÿè·µ

#### èªã‚ã‚‹ã¹ãå„ªã‚ŒãŸç‚¹

- **âœ¨ å„ªé›…ãªè¨­è¨ˆ**: ã‚·ãƒ³ãƒ—ãƒ«ã§ç†è§£ã—ã‚„ã™ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- **ğŸ¨ ç¾ã—ã„ã‚³ãƒ¼ãƒ‰**: èª­ã¿ã‚„ã™ãã€ä¸€è²«æ€§ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰
- **ğŸ”§ å·§å¦™ãªè§£æ³•**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚„ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ã‚’è€ƒæ…®ã—ãŸå®Ÿè£…
- **ğŸ›¡ï¸ å¼·å›ºãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ä¾‹å¤–çš„ã‚±ãƒ¼ã‚¹ã‚’é©åˆ‡ã«å‡¦ç†
- **ğŸ§ª ç¶²ç¾…çš„ãªãƒ†ã‚¹ãƒˆ**: ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã‚’å«ã‚€ååˆ†ãªãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

#### ãƒã‚¸ãƒ†ã‚£ãƒ–ã‚³ãƒ¡ãƒ³ãƒˆã®ä¾‹

```

ğŸ† **ç´ æ™´ã‚‰ã—ã„å®Ÿè£…ã§ã™ï¼**
ã“ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è¨­è¨ˆã¯ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¨ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚’é©åˆ‡ã«å‡¦ç†ã—ã¦ãŠã‚Šã€Goã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å®Œå…¨ã«æº–æ‹ ã—ã¦ã„ã¾ã™ã€‚

ç‰¹ã«ã€deferã‚’ä½¿ã£ãŸãƒªã‚½ãƒ¼ã‚¹ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãŒç¾ã—ãã€ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚„ã‚´ãƒ«ãƒ¼ãƒãƒ³ãƒªãƒ¼ã‚¯ã®å¿ƒé…ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

ğŸ“š **å‚è€ƒ**: [Effective Go - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ](https://golang.org/doc/effective_go#concurrency)

```

## 4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®æŠ€è¡“ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

> ğŸ“‹ **ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚µãƒãƒªãƒ¼**  
> gRPC/Protocol Buffersã€Goè¨€èªã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ç‰¹åŒ–ã—ãŸå®Ÿè·µçš„ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã€‚å…·ä½“çš„ãªã‚³ãƒ¼ãƒ‰ä¾‹ã¨å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é€šã˜ã¦ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã‚’æœ€å¤§é™ã«æ´»ç”¨ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ãƒ¢ãƒ€ãƒ³ãªãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚gRPCã«ã‚ˆã‚‹é«˜æ€§èƒ½ãªå†…éƒ¨é€šä¿¡ã€å‹å®‰å…¨ãªProtocol Buffersã€Goè¨€èªã®ä¸¦è¡Œæ€§æ©Ÿèƒ½ã‚’çµ„ã¿åˆã‚ã›ã¦ã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã§ä¿å®ˆæ€§ã®é«˜ã„ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã¯ã€ã“ã‚Œã‚‰ã®æŠ€è¡“ã‚’åŠ¹æœçš„ã«æ´»ç”¨ã—ã€ãƒãƒ¼ãƒ å…¨ä½“ã§ä¸€è²«ã—ãŸå®Ÿè£…ã‚’è¡Œã†ãŸã‚ã®æŒ‡é‡ã§ã™ã€‚å˜ãªã‚‹ãƒ«ãƒ¼ãƒ«ã§ã¯ãªãã€ãªãœãã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ¨å¥¨ã•ã‚Œã‚‹ã®ã‹ã®ç†ç”±ã¨ã€å…·ä½“çš„ãªå®Ÿè£…æ–¹æ³•ã‚’å«ã‚ã¦èª¬æ˜ã—ã¾ã™ã€‚

### 4.1. ğŸš€ gRPC & Protocol Buffers (buf + connect-go)

gRPCã¨Protocol Buffersã¯ã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é–“ã®åŠ¹ç‡çš„ã§å‹å®‰å…¨ãªé€šä¿¡ã‚’å®Ÿç¾ã—ã¾ã™ã€‚ã—ã‹ã—ã€ãã®å¼·åŠ›ã•ã‚’æœ€å¤§é™ã«æ´»ç”¨ã™ã‚‹ã«ã¯ã€é©åˆ‡ãªè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¨é‹ç”¨ãƒ«ãƒ¼ãƒ«ãŒä¸å¯æ¬ ã§ã™ã€‚

**ãªãœã“ã‚Œã‚‰ã®æŠ€è¡“ã‚’é¸æŠã—ãŸã®ã‹ï¼š**
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ãƒã‚¤ãƒŠãƒªãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«ã‚ˆã‚‹é«˜é€Ÿé€šä¿¡
- **å‹å®‰å…¨æ€§**: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®å‹ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚‹ãƒã‚°ã®æ—©æœŸç™ºè¦‹
- **è¨€èªé–“äº’æ›æ€§**: è¤‡æ•°ã®è¨€èªã§åŒã˜ã‚¹ã‚­ãƒ¼ãƒã‚’å…±æœ‰å¯èƒ½
- **å¾Œæ–¹äº’æ›æ€§**: é©åˆ‡ã«è¨­è¨ˆã™ã‚Œã°ã€APIã®é€²åŒ–ãŒå®¹æ˜“

#### 4.1.1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆåŸå‰‡

é©åˆ‡ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ã¨å‘½åã¯ã€APIã®å¯èª­æ€§ã¨ä¿å®ˆæ€§ã‚’å¤§ããå·¦å³ã—ã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ãŒæˆé•·ã—ã¦ã‚‚ç¶™ç¶šçš„ã«ç®¡ç†ã§ãã‚‹ã‚ˆã†ã€ä¸€è²«ã—ãŸæˆ¦ç•¥ã‚’ç«‹ã¦ã¾ã™ã€‚

##### ğŸ“¦ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°æˆ¦ç•¥

ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’å«ã‚€æ˜ç¢ºãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯ã€APIã®é€²åŒ–ã¨äº’æ›æ€§ã®ç®¡ç†ã‚’å®¹æ˜“ã«ã—ã¾ã™ï¼š

```protobuf
// âœ… æ¨å¥¨: æ˜ç¢ºãªéšå±¤æ§‹é€ 
package myservice.command.v1;
package myservice.query.v1;
package myservice.common.v1;

// âŒ éæ¨å¥¨: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãªã—ã€ä¸æ˜ç¢ºãªæ§‹é€ 
package myservice;
package commands;
```

**ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒé‡è¦ãªç†ç”±ï¼š**

æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹åã€æ©Ÿèƒ½ã‚«ãƒ†ã‚´ãƒªã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒæ˜ç¢ºã«åˆ†ã‹ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é–‹ç™ºè€…ã¯ã©ã®APIãŒã©ã®ã‚µãƒ¼ãƒ“ã‚¹ã®ã©ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å±ã™ã‚‹ã‹ã‚’ä¸€ç›®ã§ç†è§£ã§ãã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ã¨ä¿å®ˆæ€§ãŒå¤§å¹…ã«å‘ä¸Šã—ã¾ã™ã€‚ã¾ãŸã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã§ã€ä»¥é™ã®ç ´å£Šçš„å¤‰æ›´ã®ç®¡ç†ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚

##### ğŸ¯ å‘½åè¦ç´„ã®çµ±ä¸€

| è¦ç´  | è¦ç´„ | è‰¯ã„ä¾‹ | æ‚ªã„ä¾‹ |
| :--- | :--- | :--- | :--- |
| **RPCãƒ¡ã‚½ãƒƒãƒ‰** | `VerbNoun` | `CreateProduct`, `ListOrders` | `ProductCreate`, `GetAllOrders` |
| **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** | `MethodNameRequest/Response` | `CreateProductRequest` | `ProductCreateReq`, `CreateReq` |
| **ã‚µãƒ¼ãƒ“ã‚¹** | `NounService` | `ProductService`, `OrderService` | `Products`, `OrderManager` |
| **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰** | `snake_case` | `user_id`, `created_at` | `userId`, `CreatedAt` |

#### 4.1.2. ğŸ¨ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã§ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªAPIã‚’è¨­è¨ˆã™ã‚‹ãŸã‚ã®å®Ÿè¨¼æ¸ˆã¿ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€Google API Design Guideã‚„ä¸€èˆ¬çš„ãªãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚

##### ğŸ“„ ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ (å¿…é ˆå®Ÿè£…)

å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†APIã§ã¯ã€ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã¯å¿…é ˆã§ã™ã€‚ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ¡ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ã®ä¸€è²«æ€§ã‚’ä¿ã¡ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€é©åŒ–ã—ã¾ã™ï¼š

```protobuf
// âœ… æ¨å¥¨: ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
message ListProductsRequest {
  int32 page_size = 1;   // æœ€å¤§100ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ20
  string page_token = 2; // Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚«ãƒ¼ã‚½ãƒ«
  
  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰
  string category = 3;
  google.protobuf.Timestamp created_after = 4;
}

message ListProductsResponse {
  repeated Product products = 1;
  string next_page_token = 2;  // æ¬¡ãƒšãƒ¼ã‚¸ãªã—ã®å ´åˆã¯ç©ºæ–‡å­—åˆ—
  int32 total_count = 3;       // å¯èƒ½ãªå ´åˆã®ã¿æä¾›
}
```

**ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®æœ¬è³ªã¨åˆ©ç‚¹ï¼š**

ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†APIã§ã®æ¨™æº–çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ã€‚`page_token`ã¯ä¸é€æ˜ãªæ–‡å­—åˆ—ã§ã‚ã‚Šã€ã‚µãƒ¼ãƒãƒ¼å´ã§ãƒ‡ãƒ¼ã‚¿ã®ä½ç½®ã‚„çŠ¶æ…‹ã‚’ç®¡ç†ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒšãƒ¼ã‚¸ãƒ³ã‚°ä¸­ã«ãƒ‡ãƒ¼ã‚¿ãŒå¤‰æ›´ã•ã‚Œã¦ã‚‚ä¸€è²«æ€§ã‚’ä¿ã¤ã“ã¨ãŒã§ãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯é‡è¤‡ã‚„æ¬ æãªã—ã«ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã™ã€‚ã¾ãŸã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶ã‚’å«ã‚ã‚‹ã“ã¨ã§ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’åŠ¹ç‡çš„ã«å–å¾—ã§ãã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¸¯åŸŸã¨å‡¦ç†æ™‚é–“ã‚’ç¯€ç´„ã§ãã¾ã™ã€‚

##### ğŸ¯ éƒ¨åˆ†æ›´æ–°ãƒ‘ã‚¿ãƒ¼ãƒ³

```protobuf
import "google/protobuf/field_mask.proto";

// âœ… æ¨å¥¨: FieldMaskã‚’ä½¿ç”¨ã—ãŸéƒ¨åˆ†æ›´æ–°
message UpdateProductRequest {
  Product product = 1;
  google.protobuf.FieldMask update_mask = 2;
  
  // ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ï¼ˆæ¥½è¦³çš„ãƒ­ãƒƒã‚¯ï¼‰
  string etag = 3;
}

// ä½¿ç”¨ä¾‹ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼‰
// update_mask: "name,price,description"
```

**FieldMaskã®é©æ–°æ€§ã¨å®Ÿç”¨æ€§ï¼š**

`FieldMask`ã¯éƒ¨åˆ†æ›´æ–°ã®æ¨™æº–çš„ãªæ‰‹æ³•ã§ã€REST APIã®PATCHãƒ¡ã‚½ãƒƒãƒ‰ã«ç›¸å½“ã—ã¾ã™ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯æ›´æ–°ã—ãŸã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿ã‚’æŒ‡å®šã§ãã€ã‚µãƒ¼ãƒãƒ¼å´ã§ã¯ãã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿ã‚’æ›´æ–°ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ä¸æ„ãªãƒ‡ãƒ¼ã‚¿ã®ä¸Šæ›¸ãã‚’é˜²ã’ã‚‹ã¨åŒæ™‚ã«ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¸¯åŸŸã‚’ç¯€ç´„ã§ãã¾ã™ã€‚`etag`ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€æ¥½è¦³çš„ãƒ­ãƒƒã‚­ãƒ³ã‚°ã‚’å®Ÿç¾ã—ã€åŒæ™‚æ›´æ–°ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ã®ç ´æã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

##### ğŸ”„ å†ªç­‰æ€§ã¨ãƒªãƒˆãƒ©ã‚¤å¯¾å¿œ

```protobuf
import "buf/validate/validate.proto";

message CreateOrderRequest {
  Order order = 1;
  
  // å†ªç­‰æ€§ã‚­ãƒ¼ï¼ˆUUID v4æ¨å¥¨ï¼‰
  string idempotency_key = 2 [
    (buf.validate.field).string = {
      pattern: "^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"
      ignore_empty: true
    }
  ];
}
```

**å†ªç­‰æ€§ã‚­ãƒ¼ã®é‡è¦æ€§ã¨å®Ÿè£…è©³ç´°ï¼š**

å†ªç­‰æ€§ã‚­ãƒ¼ã¯ã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ç’°å¢ƒã§ã®ä¿¡é ¼æ€§ã®é«˜ã„é€šä¿¡ã®ãŸã‚ã«ä¸å¯æ¬ ã§ã™ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éšœå®³ã‚„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã«ã‚ˆã‚Šã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒåŒã˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¹°ã‚Šè¿”ã—é€ä¿¡ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚å†ªç­‰æ€§ã‚­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚µãƒ¼ãƒãƒ¼å´ã§ã¯åŒã˜ã‚­ãƒ¼ã§ã®é‡è¤‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¤œçŸ¥ã—ã€å®‰å…¨ã«ç„¡è¦–ã¾ãŸã¯åŒã˜çµæœã‚’è¿”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚UUID v4ã®ä½¿ç”¨ã¨æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹é¨“è¨¼ã¯ã€ã‚­ãƒ¼ã®ä¸€æ„æ€§ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®æ­£å½“æ€§ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

##### âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥

protovalidateã‚’ä½¿ç”¨ã—ãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€å‹å®‰å…¨ã§å®£è¨€çš„ãªæ–¹æ³•ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®åˆ¶ç´„ã‚’å®šç¾©ã§ãã¾ã™ã€‚ä»¥ä¸‹ã¯åŸºæœ¬çš„ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ï¼š

```protobuf
import "buf/validate/validate.proto";

message CreateUserRequest {
  // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  string email = 1 [(buf.validate.field).string.email = true];
  
  // æ–‡å­—åˆ—ã®é•·ã•ã¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  string name = 2 [(buf.validate.field).string = {
    min_len: 1
    max_len: 100
    pattern: "^[a-zA-Z0-9\\s\\-_]+$"
  }];
  
  // æ•°å€¤ã®ç¯„å›²ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  int32 age = 3 [(buf.validate.field).int32 = {
    gte: 0
    lte: 150
  }];
}
```

**protovalidateã®åˆ©ç‚¹ï¼š**

- **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: ã‚³ãƒ¼ãƒ‰ç”Ÿæˆä¸è¦ã§ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
- **Opaque APIå¯¾å¿œ**: æ–°ã—ã„protoc-gen-goã®Opaque APIã¨å®Œå…¨äº’æ›
- **å®£è¨€çš„**: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ãŒprotoãƒ•ã‚¡ã‚¤ãƒ«ã§ä¸€å…ƒç®¡ç†ã•ã‚Œã‚‹
- **å‹å®‰å…¨**: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«åˆ¶ç´„ã®å¦¥å½“æ€§ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹

#### 4.1.3. ğŸ”„ APIé€²åŒ–æˆ¦ç•¥

APIã®é€²åŒ–ã¯ã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§æœ€ã‚‚é‡è¦ãªèª²é¡Œã®ä¸€ã¤ã§ã™ã€‚ä¸é©åˆ‡ãªå¤‰æ›´ã¯ã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®åœæ­¢ã‚„ãƒ‡ãƒ¼ã‚¿ã®ä¸æ•´åˆã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

**APIé€²åŒ–ã®é‡‘å‰‡ï¼š**

- **äº’æ›æ€§ç¬¬ä¸€**: æ—¢å­˜ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å£Šã•ãªã„
- **æ¼¸é€²çš„ç§»è¡Œ**: æ®µéšçš„ãªå¤‰æ›´ã§ãƒªã‚¹ã‚¯ã‚’æœ€å°åŒ–
- **æ˜ç¢ºãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³**: å¤‰æ›´ã®ç†ç”±ã¨å½±éŸ¿ã‚’æ˜ç¢ºã«ä¼ãˆã‚‹

##### ğŸ“‹ å¤‰æ›´ç®¡ç†ãƒ«ãƒ¼ãƒ«

ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã«å¾“ã£ã¦ã€å®‰å…¨ãªAPIã®é€²åŒ–ã‚’å®Ÿç¾ã—ã¾ã™ï¼š

| å¤‰æ›´ã‚¿ã‚¤ãƒ— | è¨±å¯ | å®Ÿè£…æ–¹æ³• | æ³¨æ„ç‚¹ |
| :--- | :---: | :--- | :--- |
| **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ** | âœ… | æ–°ã—ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç•ªå·ã§è¿½åŠ  | å¸¸ã«ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ« |
| **ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å‰Šé™¤** | âš ï¸ | `reserved` ã§äºˆç´„ | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç•ªå·ã¯å†åˆ©ç”¨ç¦æ­¢ |
| **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åå¤‰æ›´** | âŒ | æ–°è¦è¿½åŠ â†’å¤ã„ã‚‚ã®ã‚’reserved | æ®µéšçš„ãªç§»è¡ŒãŒå¿…è¦ |
| **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å‹å¤‰æ›´** | âŒ | æ–°ã—ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦è¿½åŠ  | äº’æ›æ€§ãªã— |
| **å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åŒ–** | âŒ | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã§å¯¾å¿œ | protoã§ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ç¶­æŒ |

##### ğŸ›¡ï¸ ç ´å£Šçš„å¤‰æ›´ã®é˜²æ­¢

```yaml
# .github/workflows/buf.yml
- name: Breaking Change Detection
  uses: bufbuild/buf-action@v1
  with:
    breaking_against: 'https://github.com/${{ github.repository }}.git#branch=main,subdir=api'
    lint: true
    breaking: true
```

##### ğŸ“ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å»ƒæ­¢ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

```protobuf
message Product {
  string id = 1;
  string name = 2;
  
  // å»ƒæ­¢ã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®äºˆç´„
  reserved 3;           // old_price ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå‰Šé™¤æ¸ˆã¿ï¼‰
  reserved "old_price"; // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚‚äºˆç´„
  
  // æ–°ã—ã„ä¾¡æ ¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  Price price = 4;
}
```

### 4.2. ğŸ›¡ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥

ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ã€ã‚¨ãƒ©ãƒ¼ã¯é¿ã‘ã‚‰ã‚Œãªã„ç¾å®Ÿã§ã™ã€‚é‡è¦ãªã®ã¯ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸéš›ã«ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ä¿¡é ¼æ€§ã‚’ä¿ã¡ã€é©åˆ‡ãªå¾©æ—§æªç½®ã‚’å–ã‚Œã‚‹ã“ã¨ã§ã™ã€‚

**åŠ¹æœçš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®åŸå‰‡ï¼š**

- **é€æ˜æ€§**: ã‚¨ãƒ©ãƒ¼ã®åŸå› ã¨ç™ºç”Ÿç®‡æ‰€ã‚’æ˜ç¢ºã«ç‰¹å®šã§ãã‚‹
- **å›å¾©å¯èƒ½æ€§**: ä¸€æ™‚çš„ãªã‚¨ãƒ©ãƒ¼ã¯è‡ªå‹•çš„ã«å›å¾©ã‚’è©¦è¡Œã™ã‚‹
- **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£**: ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ†ã‹ã‚Šã‚„ã™ã„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æä¾›
- **é‹ç”¨æ€§**: é‹ç”¨ãƒãƒ¼ãƒ ãŒè¿…é€Ÿã«å•é¡Œã‚’ç‰¹å®šãƒ»è§£æ±ºã§ãã‚‹æƒ…å ±ã‚’æä¾›

#### 4.2.1. ã‚¨ãƒ©ãƒ¼ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

Goã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯ã€é©åˆ‡ã«ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã®ã‚ˆã†ãªæƒ…å ±ã‚’ä¿æŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ‡ãƒãƒƒã‚°æ™‚ã«å•é¡Œã®æ ¹æœ¬åŸå› ã‚’ç‰¹å®šã—ã‚„ã™ããªã‚Šã¾ã™ï¼š

```go
// âœ… æ¨å¥¨: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä»˜ãã‚¨ãƒ©ãƒ¼ãƒ©ãƒƒãƒ”ãƒ³ã‚°
func (s *ProductService) GetProduct(ctx context.Context, id string) (*Product, error) {
    product, err := s.repo.FindByID(ctx, id)
    if err != nil {
        return nil, fmt.Errorf("failed to get product %s: %w", id, err)
    }
    return product, nil
}

// âŒ éæ¨å¥¨: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã®æ¬ å¦‚
func (s *ProductService) GetProduct(ctx context.Context, id string) (*Product, error) {
    product, err := s.repo.FindByID(ctx, id)
    if err != nil {
        return nil, err // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ãŒå¤±ã‚ã‚Œã‚‹
    }
    return product, nil
}
```

**ã‚¨ãƒ©ãƒ¼ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã®å“²å­¦ã¨å®Ÿè·µçš„åˆ©ç›Šï¼š**

æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ã€`fmt.Errorf`ã®`%w`ãƒ™ãƒ¼ãƒ–ã‚’ä½¿ã£ã¦å…ƒã®ã‚¨ãƒ©ãƒ¼ã‚’ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã—ã€åŒæ™‚ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ï¼ˆã“ã®ä¾‹ã§ã¯å•†å“IDï¼‰ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸéš›ã«ã€é–‹ç™ºè€…ã¯å…·ä½“çš„ã«ã©ã®å•†å“ã®å–å¾—ã«å¤±æ•—ã—ãŸã®ã‹ã‚’ç†è§£ã§ãã€ãƒ‡ãƒãƒƒã‚°ä½œæ¥­ãŒå¤§å¹…ã«åŠ¹ç‡åŒ–ã•ã‚Œã¾ã™ã€‚ã¾ãŸã€å…ƒã®ã‚¨ãƒ©ãƒ¼ãŒä¿æŒã•ã‚Œã‚‹ãŸã‚ã€ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã‚’è¿½è·¡ã—ã¦æ ¹æœ¬åŸå› ã‚’ç‰¹å®šã§ãã¾ã™ã€‚

#### 4.2.2. ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—åˆ¤å®šã¨ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

Go 1.13ã‹ã‚‰å°å…¥ã•ã‚ŒãŸ`errors.As`ã¯ã€ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã‚’é¡ã£ã¦ç‰¹å®šã®ã‚¨ãƒ©ãƒ¼å‹ã‚’åˆ¤å®šã™ã‚‹ãŸã‚ã®æ¨™æº–çš„ãªæ–¹æ³•ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¨ãƒ©ãƒ¼ã®å‹ã«å¿œã˜ãŸåˆ†å²å‡¦ç†ã‚’å®‰å…¨ã‹ã¤ç°¡æ½”ã«è¨˜è¿°ã§ãã¾ã™ã€‚

```go
// ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼å‹ã®å®šç¾©
type DomainError struct {
    Code    string
    Message string
    Cause   error
}

func (e *DomainError) Error() string {
    if e.Cause != nil {
        return fmt.Sprintf("%s: %s: %v", e.Code, e.Message, e.Cause)
    }
    return fmt.Sprintf("%s: %s", e.Code, e.Message)
}

func (e *DomainError) Unwrap() error {
  return e.Cause
}

// ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—åˆ¥ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° (ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤)
func handleError(err error) *connect.Error {
    var domainErr *DomainError
    var mysqlErr *mysql.MySQLError
    var netErr *net.OpError

    // errors.As ã‚’ä½¿ã£ã¦ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã‚’é¡ã‚Šã€å‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
    if errors.As(err, &domainErr) {
        // ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
        switch domainErr.Code {
        case "NOT_FOUND":
            return connect.NewError(connect.CodeNotFound, domainErr)
        case "INVALID_ARGUMENT":
            return connect.NewError(connect.CodeInvalidArgument, domainErr)
        default:
            return connect.NewError(connect.CodeInternal, domainErr)
        }
    } else if errors.As(err, &mysqlErr) {
        // MySQLå›ºæœ‰ã®ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
        switch mysqlErr.Number {
        case 1062: // Duplicate entry
            return connect.NewError(connect.CodeAlreadyExists, fmt.Errorf("duplicate entry: %w", err))
        default:
            return connect.NewError(connect.CodeInternal, fmt.Errorf("database error: %w", err))
        }
    } else if errors.As(err, &netErr) {
        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
        return connect.NewError(connect.CodeUnavailable, fmt.Errorf("network error: %w", err))
    }
    
    // ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
    return connect.NewError(connect.CodeInternal, fmt.Errorf("internal server error"))
}
```

**ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼å‹ã®è¨­è¨ˆæ„å›³ã¨åŠ¹æœï¼š**

ã“ã®`DomainError`æ§‹é€ ä½“ã¯ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤ã§ç™ºç”Ÿã™ã‚‹ã‚¨ãƒ©ãƒ¼ã‚’æ§‹é€ åŒ–ã—ã€æ¨™æº–åŒ–ã™ã‚‹ãŸã‚ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚`Code`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ã‚’æ©Ÿæ¢°çš„ã«åˆ¤å®šã§ãã‚‹ã‚ˆã†ã«ã—ã€`Message`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯äººé–“ãŒèª­ã‚ã‚‹èª¬æ˜ã‚’æä¾›ã—ã¾ã™ã€‚`Cause`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚ˆã‚Šå…ƒã®ã‚¨ãƒ©ãƒ¼ã‚’ä¿æŒã—ã€ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚`handleError`é–¢æ•°ã§ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ãªgRPCã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒé©åˆ‡ãªå¯¾å¿œã‚’å–ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

#### 4.2.3. ãƒ­ã‚°å‡ºåŠ›ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹

```go
// ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒ™ãƒ«åˆ¥ã®ãƒ­ã‚°å‡ºåŠ›
func (s *ProductService) CreateProduct(ctx context.Context, req *CreateProductRequest) error {
    if err := s.validator.Validate(req); err != nil {
        // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ã¯INFOãƒ¬ãƒ™ãƒ«
        slog.InfoContext(ctx, "validation failed", 
            "error", err, 
            "request", req)
        return fmt.Errorf("validation failed: %w", err)
    }
    
    if err := s.repo.Create(ctx, req.Product); err != nil {
        // ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ã¯ERRORãƒ¬ãƒ™ãƒ«
        slog.ErrorContext(ctx, "failed to create product", 
            "error", err,
            "product_id", req.Product.Id)
        return fmt.Errorf("failed to create product: %w", err)
    }
    
    return nil
}
```

### 4.3. ğŸ”— ä¾å­˜é–¢ä¿‚ç®¡ç†

é©åˆ‡ãªä¾å­˜é–¢ä¿‚ç®¡ç†ã¯ã€ãƒ†ã‚¹ã‚¿ãƒ–ãƒ«ã§ä¿å®ˆæ€§ã®é«˜ã„ã‚³ãƒ¼ãƒ‰ã®åŸºç›¤ã§ã™ã€‚ä¾å­˜æ€§æ³¨å…¥ï¼ˆDIï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è²¬å‹™ã‚’æ˜ç¢ºã«ã—ã€çµåˆåº¦ã‚’ä¸‹ã’ã¾ã™ã€‚

**ä¾å­˜é–¢ä¿‚ç®¡ç†ã®åˆ©ç‚¹ï¼š**

- **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£**: ãƒ¢ãƒƒã‚¯ã‚’ä½¿ã£ãŸå˜ä½“ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“
- **æŸ”è»Ÿæ€§**: å®Ÿè£…ã‚’ç°¡å˜ã«åˆ‡ã‚Šæ›¿ãˆå¯èƒ½
- **ä¿å®ˆæ€§**: å¤‰æ›´ã®å½±éŸ¿ç¯„å›²ã‚’é™å®š
- **å†åˆ©ç”¨æ€§**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç‹¬ç«‹æ€§ãŒé«˜ã¾ã‚‹

#### 4.3.1. ä¾å­˜æ€§æ³¨å…¥ (DI) ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã€Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å…¥ã‚Œã€å…·è±¡ã‚’è¿”ã™ã€è¨­è¨ˆæ€æƒ³

Goã§ã¯æ˜ç¤ºçš„ãªä¾å­˜æ€§æ³¨å…¥ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯å¿…é ˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€fxãªã©ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ä¾å­˜é–¢ä¿‚ã‚’è§£æ±ºã—ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã‚’é˜²ã’ã¾ã™ã€‚

##### ğŸ¯ ã€Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å…¥ã‚Œã€å…·è±¡ï¼ˆstructï¼‰ã‚’è¿”ã™ã€åŸå‰‡

Goã®é‡è¦ãªè¨­è¨ˆæ€æƒ³ã®ä¸€ã¤ã¯ã€**ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å¼•æ•°ã¨ã—ã¦å—ã‘å–ã‚Šã€å…·è±¡å‹ï¼ˆstructï¼‰ã‚’è¿”ã™**ã“ã¨ã§ã™ã€‚ã“ã®åŸå‰‡ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®åˆ©ç‚¹ãŒå¾—ã‚‰ã‚Œã¾ã™ï¼š

**è¨­è¨ˆæ€æƒ³ã®åˆ©ç‚¹ï¼š**

- **æŸ”è»Ÿæ€§**: å‘¼ã³å‡ºã—å´ãŒå¿…è¦ã«å¿œã˜ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã—ã¦æ‰±ãˆã‚‹
- **æ˜ç¤ºæ€§**: è¿”ã‚Šå€¤ã®å‹ã‹ã‚‰å…·è±¡å‹ãŒæ˜ç¢ºã«ã‚ã‹ã‚‹
- **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£**: ä¾å­˜é–¢ä¿‚ã‚’ãƒ¢ãƒƒã‚¯ã§ç½®ãæ›ãˆã‚„ã™ã„
- **å‹å®‰å…¨æ€§**: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å‹ã®æ•´åˆæ€§ãŒä¿è¨¼ã•ã‚Œã‚‹

```go
// ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®šç¾©ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼‰
type ProductRepository interface {
    FindByID(ctx context.Context, id string) (*Product, error)
    Create(ctx context.Context, product *Product) error
    Update(ctx context.Context, product *Product) error
    Delete(ctx context.Context, id string) error
}

type ProductService interface {
    GetProduct(ctx context.Context, id string) (*Product, error)
    CreateProduct(ctx context.Context, product *Product) error
}

// ã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼‰
type ProductServiceImpl struct {
    repo      ProductRepository // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ä¾å­˜
    validator Validator
    logger    *slog.Logger
}

// âœ… æ¨å¥¨: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å–ã‚Šã€å…·è±¡å‹ã‚’è¿”ã™
// ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿åã« "Impl" ã‚’å«ã‚ã‚‹ã“ã¨ã§ã€å…·è±¡å‹ã‚’è¿”ã™ã“ã¨ã‚’æ˜ç¤º
func NewProductServiceImpl(
    repo ProductRepository,      // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å…¥ã‚Œã‚‹
    validator Validator,          // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å…¥ã‚Œã‚‹
    logger *slog.Logger,
) *ProductServiceImpl {           // å…·è±¡å‹ã‚’è¿”ã™
    return &ProductServiceImpl{
        repo:      repo,
        validator: validator,
        logger:    logger,
    }
}

// ä½¿ç”¨ä¾‹ï¼šå‘¼ã³å‡ºã—å´ã§å¿…è¦ã«å¿œã˜ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã—ã¦æ‰±ã†
func main() {
    // å…·è±¡å‹ã¨ã—ã¦å—ã‘å–ã‚‹
    svc := NewProductServiceImpl(repo, validator, logger)
    
    // å¿…è¦ã«å¿œã˜ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ç”¨
    var service ProductService = svc
    
    // ã¾ãŸã¯ç›´æ¥ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å¤‰æ•°ã«ä»£å…¥
    var service2 ProductService = NewProductServiceImpl(repo, validator, logger)
}

// âŒ éæ¨å¥¨: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¿”ã™ãƒ‘ã‚¿ãƒ¼ãƒ³
func NewProductService(
    repo ProductRepository,
    validator Validator,
    logger *slog.Logger,
) ProductService {  // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¿”ã™ï¼ˆæ¨å¥¨ã•ã‚Œãªã„ï¼‰
    return &ProductServiceImpl{
        repo:      repo,
        validator: validator,
        logger:    logger,
    }
}
```

**ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ¨å¥¨ã•ã‚Œã‚‹ç†ç”±ï¼š**

1. **å‘¼ã³å‡ºã—å´ã®è‡ªç”±åº¦**: å…·è±¡å‹ã‚’å—ã‘å–ã‚‹ã“ã¨ã§ã€å‘¼ã³å‡ºã—å´ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã—ã¦æ‰±ã†ã‹ã€å…·è±¡å‹ã¨ã—ã¦æ‰±ã†ã‹ã‚’é¸æŠã§ãã¾ã™ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¿”ã™å ´åˆã€ã“ã®é¸æŠè‚¢ãŒå¤±ã‚ã‚Œã¾ã™ã€‚

2. **å®Ÿè£…ã®æ˜ç¢ºæ€§**: ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿åã«`Impl`ã‚’å«ã‚ã‚‹ã“ã¨ã§ã€å…·è±¡å‹ã‚’è¿”ã™ã“ã¨ãŒä¸€ç›®ã§ã‚ã‹ã‚Šã€ã‚³ãƒ¼ãƒ‰ã®æ„å›³ãŒæ˜ç¢ºã«ãªã‚Šã¾ã™ã€‚

3. **DIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã®è¦ªå’Œæ€§**: Uber Fxãªã©ã®DIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ã€å…·è±¡å‹ã‚’è¿”ã™ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’`fx.Annotate`ã¨`fx.As`ã§ç°¡å˜ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å¤‰æ›ã§ãã¾ã™ã€‚

4. **ãƒ‡ãƒãƒƒã‚°ã®å®¹æ˜“æ€§**: å…·è±¡å‹ã‚’è¿”ã™ã“ã¨ã§ã€ãƒ‡ãƒãƒƒã‚¬ãƒ¼ã§å®Ÿéš›ã®å‹æƒ…å ±ã‚’ç¢ºèªã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

##### ğŸ“¦ ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…ã®ä¾‹

```go
// ãƒªãƒã‚¸ãƒˆãƒªã®å®Ÿè£…ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ï¼‰
type ProductRepositoryImpl struct {
    db *sql.DB
}

// âœ… æ¨å¥¨: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å–ã‚Šã€å…·è±¡å‹ã‚’è¿”ã™
func NewProductRepositoryImpl(db *sql.DB) *ProductRepositoryImpl {
    return &ProductRepositoryImpl{
        db: db,
    }
}

// ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
func (r *ProductRepositoryImpl) FindByID(ctx context.Context, id string) (*Product, error) {
    // å®Ÿè£…...
}
```

```

**ä¾å­˜æ€§æ³¨å…¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã€Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å…¥ã‚Œã€å…·è±¡ã‚’è¿”ã™ã€ã®é€£æºï¼š**

ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æœ¬è³ªã¯ã€å…·ä½“çš„ãªå®Ÿè£…ã§ã¯ãªãæŠ½è±¡çš„ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ä¾å­˜ã™ã‚‹ã“ã¨ã§ã™ã€‚`ProductServiceImpl`ã¯`ProductRepository`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ä¾å­˜ã—ã€å…·ä½“çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å®Ÿè£…ï¼ˆMySQLã€PostgreSQLãªã©ï¼‰ã‚’çŸ¥ã‚Šã¾ã›ã‚“ã€‚

ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯**ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å¼•æ•°ã¨ã—ã¦å—ã‘å–ã‚‹**ã“ã¨ã§ä¾å­˜é–¢ä¿‚ã‚’æŠ½è±¡åŒ–ã—ã€**å…·è±¡å‹ã‚’è¿”ã™**ã“ã¨ã§å‘¼ã³å‡ºã—å´ã«æŸ”è»Ÿæ€§ã‚’æä¾›ã—ã¾ã™ï¼š

- **ãƒ†ã‚¹ãƒˆæ™‚**: ãƒ¢ãƒƒã‚¯ãƒªãƒã‚¸ãƒˆãƒªã‚’æ³¨å…¥ã—ã¦å˜ä½“ãƒ†ã‚¹ãƒˆãŒå¯èƒ½
- **æœ¬ç•ªç’°å¢ƒ**: å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å®Ÿè£…ã‚’æ³¨å…¥
- **å‘¼ã³å‡ºã—å´ã®é¸æŠ**: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã—ã¦æ‰±ã†ã‹ã€å…·è±¡å‹ã¨ã—ã¦æ‰±ã†ã‹ã‚’æ±ºå®š

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãªãã€ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’åˆ‡ã‚Šæ›¿ãˆãŸã‚Šã€å®Ÿè£…ã‚’è¿½åŠ ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ã®ä¾å­˜æ€§æ³¨å…¥ã¯ã€ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¤ºçš„ã«ã—ã€åˆæœŸåŒ–æ™‚ã«å¿…è¦ãªã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæä¾›ã•ã‚Œã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

#### 4.3.2. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ ã¨Uber Fxã«ã‚ˆã‚‹ä¾å­˜æ€§æ³¨å…¥

> ğŸ’¡ **Geminiå‘ã‘ã®é‡è¦ãªæ³¨æ„äº‹é …**  
> ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯**Uber Fx**ã‚’ä¾å­˜æ€§æ³¨å…¥ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã—ã¦æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚Google Wireã¯ä½¿ç”¨ã—ã¦ã„ã¾ã›ã‚“ã€‚ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚„ææ¡ˆã‚’è¡Œã†éš›ã¯ã€å¿…ãšFxã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

ã€Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å…¥ã‚Œã€å…·è±¡ã‚’è¿”ã™ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€Uber Fxã¨éå¸¸ã«ç›¸æ€§ãŒè‰¯ãã€`fx.Annotate`ã¨`fx.As`ã‚’ä½¿ç”¨ã—ã¦å…·è±¡å‹ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å¤‰æ›ã§ãã¾ã™ï¼š

```go
// internal/infrastructure/sqlboiler/module.go
package sqlboiler

import (
    "go.uber.org/fx"
    "yourproject/internal/application/service"
    "yourproject/internal/domain/models/categories"
    "yourproject/internal/domain/models/products"
    "yourproject/internal/infrastructure/sqlboiler/repository"
)

// Module ã¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ã®Fxãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚
// ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚„ãƒªãƒã‚¸ãƒˆãƒªã®å®Ÿè£…ã‚’æä¾›ã—ã¾ã™ã€‚
var Module = fx.Module(
    "sqlboiler",
    fx.Provide(
        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã®æä¾›
        NewDatabase,
        
        // ãƒªãƒã‚¸ãƒˆãƒªã®æä¾›
        // NewProductRepositoryImpl ã¯ *ProductRepositoryImpl ã‚’è¿”ã™ï¼ˆå…·è±¡å‹ï¼‰
        fx.Annotate(
            repository.NewProductRepositoryImpl,
            // fx.As ã§å…·è±¡å‹ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å¤‰æ›
            fx.As(new(products.ProductRepository)),
        ),
        fx.Annotate(
            repository.NewCategoryRepositoryImpl,
            fx.As(new(categories.CategoryRepository)),
        ),
        
        // ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®æä¾›
        fx.Annotate(
            repository.NewTransactionManagerImpl,
            fx.As(new(service.TransactionManager)),
        ),
    ),
    // ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯ã®ç™»éŒ²
    fx.Invoke(registerLifecycleHooks),
)
```

```go
// internal/application/module.go
package application

import (
    "go.uber.org/fx"
    "yourproject/internal/application/impl"
    "yourproject/internal/application/service"
    "yourproject/internal/infrastructure/sqlboiler"
)

// Module ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®Fxãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚
// ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æä¾›ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ§‹æˆã—ã¾ã™ã€‚
var Module = fx.Module(
    "application",
    // ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ã®ä¾å­˜é–¢ä¿‚ã‚’å«ã‚ã‚‹
    sqlboiler.Module,
    fx.Provide(
        // ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›
        // NewProductServiceImpl ã¯ *ProductServiceImpl ã‚’è¿”ã™ï¼ˆå…·è±¡å‹ï¼‰
        fx.Annotate(
            impl.NewProductServiceImpl,
            // fx.As ã§å…·è±¡å‹ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å¤‰æ›
            fx.As(new(service.ProductService)),
        ),
        fx.Annotate(
            impl.NewCategoryServiceImpl,
            fx.As(new(service.CategoryService)),
        ),
    ),
)
```

```go
// cmd/server/main.go
package main

import (
    "context"
    "log"
    
    "go.uber.org/fx"
    "yourproject/internal/application"
    "yourproject/internal/presentation"
)

func main() {
    app := fx.New(
        // ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç™»éŒ²
        application.Module,      // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©å±¤ã‚’å«ã‚€ï¼‰
        presentation.Module,     // ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤
        
        // ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
        fx.Invoke(func(server *Server) {
            // FxãŒãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã€ã“ã“ã§ã¯ä½•ã‚‚ã—ãªã„
        }),
    )
    
    // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•ã¨åœæ­¢
    app.Run()
}
```

**Uber Fxã¨ã€Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å…¥ã‚Œã€å…·è±¡ã‚’è¿”ã™ã€ã®ç›¸ä¹—åŠ¹æœï¼š**

Uber Fxã¯ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ä¾å­˜é–¢ä¿‚ã‚’è§£æ±ºã™ã‚‹å¼·åŠ›ãªDIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚ã€Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å…¥ã‚Œã€å…·è±¡ã‚’è¿”ã™ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã®çµ„ã¿åˆã‚ã›ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®åˆ©ç‚¹ãŒå¾—ã‚‰ã‚Œã¾ã™ï¼š

1. **æ˜ç¤ºçš„ãªå‹å¤‰æ›**: `fx.Annotate`ã¨`fx.As`ã«ã‚ˆã‚Šã€å…·è±¡å‹ï¼ˆ`*ProductRepositoryImpl`ï¼‰ã‹ã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆ`ProductRepository`ï¼‰ã¸ã®å¤‰æ›ãŒæ˜ç¢ºã«ãªã‚Šã¾ã™ã€‚

2. **ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼è¨­è¨ˆ**: `fx.Module`ã«ã‚ˆã‚Šã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å±¤ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©å±¤ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ãªã©ï¼‰ã‚’æ˜ç¢ºã«åˆ†é›¢ã—ã€ä¾å­˜é–¢ä¿‚ã‚’å¯è¦–åŒ–ã§ãã¾ã™ã€‚

3. **ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†**: Fxã¯è‡ªå‹•çš„ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆæœŸåŒ–ã¨çµ‚äº†å‡¦ç†ã‚’ç®¡ç†ã—ã€ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ¼ã‚¯ã‚’é˜²ãã¾ã™ã€‚

4. **æŸ”è»Ÿãªå®Ÿè£…åˆ‡ã‚Šæ›¿ãˆ**: åŒã˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å¯¾ã—ã¦ç•°ãªã‚‹å…·è±¡å‹ã‚’ç°¡å˜ã«åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™ã€‚`fx.Decorate`ã‚„`fx.Replace`ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚„é–‹ç™ºç’°å¢ƒã§å®Ÿè£…ã‚’ä¸Šæ›¸ãã§ãã¾ã™ã€‚

5. **ä¾å­˜é–¢ä¿‚ã®è‡ªå‹•è§£æ±º**: ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å¼•æ•°ã¨ã—ã¦å¿…è¦ãªä¾å­˜é–¢ä¿‚ã‚’å®£è¨€ã™ã‚‹ã ã‘ã§ã€FxãŒè‡ªå‹•çš„ã«è§£æ±ºãƒ»æ³¨å…¥ã—ã¾ã™ã€‚

**Fxã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š**

- **å±¤ã”ã¨ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†é›¢**: ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã€ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã‚’ãã‚Œãã‚Œç‹¬ç«‹ã—ãŸFxãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦å®šç¾©
- **æ˜ç¤ºçš„ãªä¾å­˜é–¢ä¿‚**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯å¿…è¦ãªä¾å­˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æ˜ç¤ºçš„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹æŒ‡å‘**: `fx.As`ã«ã‚ˆã‚Šã€å®Ÿè£…ã®è©³ç´°ã‚’éš è”½ã—ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’é€šã˜ã¦é€£æº

ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ã€ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ã€ä¿å®ˆæ€§ãŒå¤§å¹…ã«å‘ä¸Šã—ã¾ã™ã€‚

#### 4.3.3. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†æˆ¦ç•¥

```go
// go.mod
module github.com/yourorg/yourproject

go 1.21

require (
    // gRPCé–¢é€£
    connectrpc.com/connect v1.11.1
    google.golang.org/protobuf v1.31.0
    
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    github.com/bufbuild/protovalidate-go v0.4.2
    
    // ä¾å­˜æ€§æ³¨å…¥ï¼ˆDIï¼‰
    go.uber.org/fx v1.20.1
    
    // ãƒ­ã‚®ãƒ³ã‚°
    // log/slog ã¯ Go 1.21+ ã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
)

// ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®æ‰‹é †
// 1. Dependabotã®è¨­å®š
// 2. å®šæœŸçš„ãª`go mod tidy && go mod verify`
// 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®å„ªå…ˆçš„é©ç”¨
```

> ğŸ’¡ **Geminiå‘ã‘ã®ä¾å­˜é–¢ä¿‚ç®¡ç†ã‚¬ã‚¤ãƒ‰**  
> æ–°ã—ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹éš›ã¯ã€å¿…ãš`go.mod`ã«é©åˆ‡ãªä¾å­˜é–¢ä¿‚ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚ç‰¹ã«ï¼š
>
> - DIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯: `go.uber.org/fx`
> - ãƒ†ã‚¹ãƒ†ã‚£ãƒ³ã‚°: `github.com/onsi/ginkgo/v2`, `github.com/onsi/gomega`
> - ãƒ¢ãƒƒã‚¯ç”Ÿæˆ: `github.com/golang/mock`

### 4.4. ğŸŒ Goãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…

Goã®è¨€èªç‰¹æ€§ï¼ˆä¸¦è¡Œæ€§ã€ã‚·ãƒ³ãƒ—ãƒ«ã•ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼‰ã‚’æ´»ã‹ã—ãŸãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’èª¬æ˜ã—ã¾ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã®é‹ç”¨ã‚’è€ƒæ…®ã—ãŸã€å®Ÿç”¨çš„ã§å …ç‰¢ãªå®Ÿè£…æ–¹æ³•ã‚’é‡è¦–ã—ã¾ã™ã€‚

**GoãŒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã«é©ã—ã¦ã„ã‚‹ç†ç”±ï¼š**

- **è»½é‡**: å°ã•ãªãƒ¡ãƒ¢ãƒªãƒ•ãƒƒãƒˆãƒ—ãƒªãƒ³ãƒˆã§å¤šæ•°ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç¨¼åƒå¯èƒ½
- **ä¸¦è¡Œæ€§**: Goroutineã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªä¸¦è¡Œå‡¦ç†
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: å˜ä¸€ãƒã‚¤ãƒŠãƒªã§ã®ç°¡å˜ãªãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã€é«˜ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã‚’å®Ÿç¾

#### 4.4.1. ğŸ“Š è¨­å®šç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³

ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ã€ç’°å¢ƒã”ã¨ã«ç•°ãªã‚‹è¨­å®šã‚’æŸ”è»Ÿã«ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚Twelve-Factor Appã®åŸå‰‡ã«å¾“ã„ã€ç’°å¢ƒå¤‰æ•°ã‚’ä¸­å¿ƒã¨ã—ãŸè¨­å®šç®¡ç†ã‚’è¡Œã„ã¾ã™ï¼š

```go
// config/config.go
type Config struct {
    Server   ServerConfig   `env:",prefix=SERVER_"`
    Database DatabaseConfig `env:",prefix=DB_"`
    Redis    RedisConfig    `env:",prefix=REDIS_"`
    Log      LogConfig      `env:",prefix=LOG_"`
}

type ServerConfig struct {
    Port         int           `env:"PORT,default=8080"`
    ReadTimeout  time.Duration `env:"READ_TIMEOUT,default=30s"`
    WriteTimeout time.Duration `env:"WRITE_TIMEOUT,default=30s"`
    GrpcPort     int           `env:"GRPC_PORT,default=9090"`
}

type DatabaseConfig struct {
    Host         string        `env:"HOST,default=localhost"`
    Port         int           `env:"PORT,default=3306"`
    User         string        `env:"USER,required"`
    Password     string        `env:"PASSWORD,required"`
    Database     string        `env:"NAME,required"`
    MaxOpenConns int           `env:"MAX_OPEN_CONNS,default=25"`
    MaxIdleConns int           `env:"MAX_IDLE_CONNS,default=5"`
    MaxLifetime  time.Duration `env:"MAX_LIFETIME,default=5m"`
}

// è¨­å®šã®èª­ã¿è¾¼ã¿ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
func Load() (*Config, error) {
    var cfg Config
    if err := env.Parse(&cfg); err != nil {
        return nil, fmt.Errorf("failed to parse config: %w", err)
    }
    
    if err := cfg.Validate(); err != nil {
        return nil, fmt.Errorf("invalid config: %w", err)
    }
    
    return &cfg, nil
}

func (c *Config) Validate() error {
    if c.Server.Port <= 0 || c.Server.Port > 65535 {
        return errors.New("invalid server port")
    }
    // ãã®ä»–ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³...
    return nil
}
```

**æ§‹é€ åŒ–è¨­å®šç®¡ç†ã®å“²å­¦ã¨å®Ÿè£…ã®å¦™å‘³ï¼š**

ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€Twelve-Factor Appã®ã€Œè¨­å®šã¯ç’°å¢ƒå¤‰æ•°ã«æ ¼ç´ã€åŸå‰‡ã‚’Goã§å®Ÿç¾ã™ã‚‹ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆãªæ–¹æ³•ã§ã™ã€‚æ§‹é€ ä½“ã‚¿ã‚°ã§ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å®£è¨€çš„ã«è¨˜è¿°ã§ãã€è¨­å®šã®æ„å›³ãŒã‚³ãƒ¼ãƒ‰è‡ªä½“ã§æ˜ç¢ºã«ãªã‚Šã¾ã™ã€‚ç’°å¢ƒå¤‰æ•°åã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹åŒ–ã«ã‚ˆã‚Šã€è¤‡æ•°ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒåŒã˜ã‚³ãƒ³ãƒ†ãƒŠã§å‹•ä½œã—ã¦ã‚‚è¨­å®šã®ç«¶åˆã‚’é¿ã‘ã‚‰ã‚Œã€`Validate`ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚Šèµ·å‹•æ™‚ã«è¨­å®šã®æ•´åˆæ€§ã‚’ç¢ºèªã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€è¨³ã®ã‚ã‹ã‚‰ãªã„ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã‚’é˜²ã’ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

#### 4.4.2. ãƒ­ã‚®ãƒ³ã‚°

ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ç’°å¢ƒã§ã¯ã€ãƒ­ã‚°ã¯ãƒ‡ãƒãƒƒã‚°ã€ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ä¸»è¦ãªæ‰‹æ®µã§ã™ã€‚æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ­ã‚°ã¯ã€è‡ªå‹•è§£æãƒ„ãƒ¼ãƒ«ã‚„ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºã‚’å®¹æ˜“ã«ã—ã¾ã™ã€‚

**åŸå‰‡**:

- **æ§‹é€ åŒ–**: æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã® `log/slog` ã‚’ä½¿ç”¨ã—ã€æœ¬ç•ªç’°å¢ƒã§ã¯JSONå½¢å¼ã§å‡ºåŠ›ã™ã‚‹ã€‚
- **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã‚„ãƒˆãƒ¬ãƒ¼ã‚¹IDãªã©ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã‚’ã™ã¹ã¦ã®ãƒ­ã‚°ã«å«ã‚ã‚‹ã€‚
- **ãƒ¬ãƒ™ãƒ«**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆèµ·å› ã®ã‚¨ãƒ©ãƒ¼ã¯`INFO`ã€ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã®å•é¡Œã¯`ERROR`ãƒ¬ãƒ™ãƒ«ã§è¨˜éŒ²ã™ã‚‹ã€‚

```go
// pkg/logging/logger.go

// NewLogger ã¯ç’°å¢ƒã«å¿œã˜ãŸslog.Loggerã‚’ç”Ÿæˆã—ã¾ã™ã€‚
func NewLogger(level string, isDevelopment bool) *slog.Logger {
 var logLevel slog.Level
 switch strings.ToLower(level) {
 case "debug":
  logLevel = slog.LevelDebug
 case "warn":
  logLevel = slog.LevelWarn
 case "error":
  logLevel = slog.LevelError
 default:
  logLevel = slog.LevelInfo
 }

 opts := &slog.HandlerOptions{
  Level:     logLevel,
  AddSource: isDevelopment, // é–‹ç™ºæ™‚ã®ã¿ã‚½ãƒ¼ã‚¹ä½ç½®ã‚’å‡ºåŠ›
 }

 var handler slog.Handler
 if isDevelopment {
  handler = slog.NewTextHandler(os.Stdout, opts)
 } else {
  handler = slog.NewJSONHandler(os.Stdout, opts)
 }

 logger := slog.New(handler)
 slog.SetDefault(logger) // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ­ã‚¬ãƒ¼ã¨ã—ã¦è¨­å®š
 return logger
}
```

#### 4.4.3. ğŸ”„ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³

Goã®`context.Context`ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¹ã‚³ãƒ¼ãƒ—ã®æƒ…å ±ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚·ã‚°ãƒŠãƒ«ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®æ¨™æº–çš„ãªæ‰‹æ®µã§ã™ã€‚é©åˆ‡ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã«é©åˆ‡ã«å¯¾å¿œã§ãã¾ã™ã€‚

**åŸå‰‡**:

- **ä¼æ’­**: ã™ã¹ã¦ã®é–¢æ•°å‘¼ã³å‡ºã—ã§ç¬¬ä¸€å¼•æ•°ã¨ã—ã¦æ¸¡ã™ã€‚
- **ã‚­ãƒ¼ç®¡ç†**: ã‚­ãƒ¼ã®è¡çªã‚’é¿ã‘ã‚‹ãŸã‚ã€ç‹¬è‡ªå‹ã‚’å®šç¾©ã™ã‚‹ã€‚
- **å€¤ã®ã‚¹ã‚³ãƒ¼ãƒ—**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¹ã‚³ãƒ¼ãƒ—ã®æƒ…å ±ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã€èªè¨¼æƒ…å ±ãªã©ï¼‰ã®ã¿ã‚’æ ¼ç´ã™ã‚‹ã€‚

```go
// context/context.go
type contextKey string

const (
 RequestIDKey contextKey = "request_id"
 LoggerKey    contextKey = "logger"
)

// WithLogger ã¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ãƒ­ã‚¬ãƒ¼ã‚’æ ¼ç´ã—ã¾ã™ã€‚
func WithLogger(ctx context.Context, logger *slog.Logger) context.Context {
 return context.WithValue(ctx, LoggerKey, logger)
}

// FromContext ã¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ãƒ­ã‚¬ãƒ¼ã‚’å–å¾—ã—ã¾ã™ã€‚
func FromContext(ctx context.Context) *slog.Logger {
 if logger, ok := ctx.Value(LoggerKey).(*slog.Logger); ok {
  return logger
 }
 return slog.Default() // è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ­ã‚¬ãƒ¼ã‚’è¿”ã™
}

// ä½¿ç”¨ä¾‹ (Interceptor)
func NewLoggingInterceptor() connect.UnaryInterceptor {
 return func(next connect.UnaryFunc) connect.UnaryFunc {
  return func(ctx context.Context, req connect.AnyRequest) (connect.AnyResponse, error) {
   requestID := uuid.NewString() // or from header
   logger := slog.With("request_id", requestID, "procedure", req.Spec().Procedure)
   ctx = WithLogger(ctx, logger)

   logger.InfoContext(ctx, "request started")
   res, err := next(ctx, req)
   if err != nil {
    logger.ErrorContext(ctx, "request failed", "error", err)
   } else {
    logger.InfoContext(ctx, "request finished")
   }
   return res, err
  }
 }
}

// ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰å€¤ã‚’å–å¾—
func GetRequestID(ctx context.Context) string {
    if requestID, ok := ctx.Value(RequestIDKey).(string); ok {
        return requestID
    }
    return ""
}

// ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¨ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
func (s *ProductService) GetProduct(ctx context.Context, id string) (*Product, error) {
    // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ä½œæˆ
    ctx, cancel := context.WithTimeout(ctx, 5*time.Second)
    defer cancel()
    
    // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒã‚§ãƒƒã‚¯
    select {
    case <-ctx.Done():
        return nil, fmt.Errorf("request cancelled: %w", ctx.Err())
    default:
    }
    
    product, err := s.repo.FindByID(ctx, id)
    if err != nil {
        return nil, fmt.Errorf("failed to get product: %w", err)
    }
    
    return product, nil
}
```

#### 4.4.4. Graceful Shutdown

ã‚µãƒ¼ãƒ“ã‚¹ã®åœæ­¢æ™‚ã«ã€å‡¦ç†ä¸­ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é©åˆ‡ã«å®Œäº†ã•ã›ã€ãƒªã‚½ãƒ¼ã‚¹ã‚’æ­£å¸¸ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ä¿ã¡ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚

**åŸå‰‡**:

- **ã‚·ã‚°ãƒŠãƒ«ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: `os.Signal` ã‚’æ•æ‰ã—ã€`SIGINT` ã‚„ `SIGTERM` ã‚’å—ã‘å–ã£ãŸéš›ã«ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³å‡¦ç†ã‚’é–‹å§‹ã™ã‚‹ã€‚
- **ä¸¦è¡Œã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: `errgroup` ã‚’ä½¿ç”¨ã—ã¦ã€HTTPã‚µãƒ¼ãƒãƒ¼ã€DBã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã€ãã®ä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¯ãƒ­ãƒ¼ã‚ºå‡¦ç†ã‚’ä¸¦è¡Œã—ã¦è¡Œã„ã€ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³æ™‚é–“ã‚’çŸ­ç¸®ã™ã‚‹ã€‚
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³å‡¦ç†å…¨ä½“ã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’è¨­å®šã—ã€ç„¡æœŸé™ã«ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ã®ã‚’é˜²ãã€‚

```go
// cmd/server/main.go
func main() {
 ctx, stop := signal.NotifyContext(context.Background(), os.Interrupt, syscall.SIGTERM)
 defer stop()

 // ... ï¼ˆè¨­å®šèª­ã¿è¾¼ã¿ã€ãƒ­ã‚¬ãƒ¼ãƒ»ã‚µãƒ¼ãƒãƒ¼åˆæœŸåŒ–ï¼‰
 // server ã¯ *http.Server ã‚’æŒã¤æ§‹é€ ä½“
 // cleanup ã¯DBãªã©ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’è§£æ”¾ã™ã‚‹é–¢æ•°

 // ã‚µãƒ¼ãƒãƒ¼ã‚’goroutineã§èµ·å‹•
 go func() {
  slog.Info("starting server", "addr", server.Addr)
  if err := server.ListenAndServe(); err != nil && !errors.Is(err, http.ErrServerClosed) {
   slog.Error("failed to start server", "error", err)
   stop() // ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã«å¤±æ•—ã—ãŸã‚‰ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³
  }
 }()

 // ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã‚·ã‚°ãƒŠãƒ«ã‚’å¾…æ©Ÿ
 <-ctx.Done()
 slog.Info("shutdown signal received, starting graceful shutdown")

 // Graceful shutdownã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
 shutdownCtx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
 defer cancel()

 // HTTPã‚µãƒ¼ãƒãƒ¼ã®ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³
 if err := server.Shutdown(shutdownCtx); err != nil {
  slog.Error("HTTP server shutdown error", "error", err)
 }

 // ãã®ä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
 if err := cleanup(); err != nil {
  slog.Error("cleanup error", "error", err)
 }

 slog.Info("server stopped gracefully")
}
```

#### 4.4.5. ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

**ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰ã®æ§‹æˆï¼š**

- **çµåˆãƒ†ã‚¹ãƒˆ** (20%): ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®é€£æºãƒ†ã‚¹ãƒˆ
- **E2Eãƒ†ã‚¹ãƒˆ** (10%): ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®å‹•ä½œç¢ºèª

```go
// ãƒ†ãƒ¼ãƒ–ãƒ«é§†å‹•ãƒ†ã‚¹ãƒˆã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
func TestProductService_CreateProduct(t *testing.T) {
    tests := []struct {
        name    string
        input   *CreateProductRequest
        setup   func(*testing.T) ProductRepository
        want    *Product
        wantErr bool
        errType error
    }
    {
        {
            name: "æ­£å¸¸ã‚±ãƒ¼ã‚¹",
            input: &CreateProductRequest{
                Product: &Product{
                    Name:     "Test Product",
                    Price:    1000,
                    Category: "Electronics",
                },
            },
            setup: func(t *testing.T) ProductRepository {
                repo := &MockProductRepository{}
                repo.On("Create", mock.Anything, mock.Anything).Return(nil)
                return repo
            },
            wantErr: false,
        },
        {
            name: "ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼",
            input: &CreateProductRequest{
                Product: &Product{
                    Name:  "", // ç©ºæ–‡å­—åˆ—
                    Price: -100, // è² ã®å€¤
                },
            },
            setup: func(t *testing.T) ProductRepository {
                return &MockProductRepository{}
            },
            wantErr: true,
            errType: &ValidationError{},
        },
    }
    
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            repo := tt.setup(t)
            service := NewProductService(repo, NewValidator(), slog.Default())
            
            ctx := context.Background()
            got, err := service.CreateProduct(ctx, tt.input)
            
            if tt.wantErr {
                assert.Error(t, err)
                if tt.errType != nil {
                    assert.ErrorAs(t, err, &tt.errType)
                }
                return
            }
            
            assert.NoError(t, err)
            assert.Equal(t, tt.want, got)
        })
    }
}

// ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã®ä¾‹
func TestProductHandler_Integration(t *testing.T) {
    // ãƒ†ã‚¹ãƒˆç”¨DBã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    db := setupTestDB(t)
    defer cleanupTestDB(t, db)
    
    // ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
    server := setupTestServer(t, db)
    defer server.Close()
    
    client := connectclient.NewProductServiceClient(
        http.DefaultClient,
        server.URL,
    )
    
    // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    res, err := client.CreateProduct(context.Background(), connect.NewRequest(&CreateProductRequest{
        Product: &Product{
            Name:     "Integration Test Product",
            Price:    2000,
            Category: "Test",
        },
    }))
    
    assert.NoError(t, err)
    assert.NotEmpty(t, res.Msg.Product.Id)
    assert.Equal(t, "Integration Test Product", res.Msg.Product.Name)
}
```

**ãƒ†ãƒ¼ãƒ–ãƒ«é§†å‹•ãƒ†ã‚¹ãƒˆã®å“²å­¦ã¨å®Ÿè£…ç¾å­¦ï¼š**

ãƒ†ãƒ¼ãƒ–ãƒ«é§†å‹•ãƒ†ã‚¹ãƒˆã¯ã€åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç•°ãªã‚‹å…¥åŠ›ã§ç¶²ç¾…çš„ã«ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆãªæ‰‹æ³•ã§ã™ã€‚å„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¯æ§‹é€ ä½“ã§å®šç¾©ã•ã‚Œã€`name`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§æ˜ç¢ºãªèª¬æ˜ã€`setup`é–¢æ•°ã§ãƒ†ã‚¹ãƒˆå›ºæœ‰ã®ãƒ¢ãƒƒã‚¯è¨­å®šã€`wantErr`ã¨`errType`ã§ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®é¨“è¨¼ã‚’è¡Œã„ã¾ã™ã€‚ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å¼·åŠ›ã•ã¯ã€æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®è¿½åŠ ãŒç°¡å˜ã§ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‰ã‚Œã‚‹ã“ã¨ã§ã™ã€‚ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã§ã¯ã€å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨HTTPã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®çµåˆéƒ¨ã‚’æ¤œè¨¼ã—ã€å˜ä½“ãƒ†ã‚¹ãƒˆã§ã¯æ•æ‰ã§ããªã„å•é¡Œã‚’ç™ºè¦‹ã§ãã¾ã™ã€‚

---

## 5. ğŸš€ ã¾ã¨ã‚ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

> ğŸ“‹ **ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚µãƒãƒªãƒ¼**  
> ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’é€šã˜ã¦é‡è¦ãªåŸå‰‡ã¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ã¾ã¨ã‚ã€‚æ—¥å¸¸çš„ãªé–‹ç™ºã‹ã‚‰ãƒªãƒªãƒ¼ã‚¹ã¾ã§ã€å“è³ªã‚’ä¿ã¤ãŸã‚ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

ã“ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ã§èª¬æ˜ã—ãŸå„è¦ç´ ã¯ã€ç‹¬ç«‹ã—ãŸãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã§ã¯ãªãã€ç›¸äº’ã«é–¢é€£ã—åˆã†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ–‡åŒ–ã€æŠ€è¡“çš„ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ãƒãƒ¼ãƒ ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒçµ„ã¿åˆã‚ã•ã‚‹ã“ã¨ã§ã€åˆã‚ã¦æŒç¶šå¯èƒ½ã§ä¾¡å€¤ã‚ã‚‹é–‹ç™ºãŒå®Ÿç¾ã•ã‚Œã¾ã™ã€‚

**ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ã®çœŸã®ç›®çš„ï¼š**

1. **åŠ¹ç‡æ€§ã®å‘ä¸Š**: ä¸€è²«ã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚Šã€èªçŸ¥è² è·ã‚’æ¸›ã‚‰ã—é–‹ç™ºé€Ÿåº¦ã‚’å‘ä¸Š
2. **å“è³ªã®ä¿è¨¼**: ä½“ç³»çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã€ãƒã‚°ã‚„è¨­è¨ˆå•é¡Œã‚’æ—©æœŸã«ç™ºè¦‹ãƒ»ä¿®æ­£
3. **çŸ¥è­˜ã®å…±æœ‰**: ãƒãƒ¼ãƒ å…¨ä½“ã§æŠ€è¡“çš„ãªçŸ¥è¦‹ã‚’å…±æœ‰ã—ã€é›†åˆçŸ¥ã‚’æ´»ç”¨
4. **æŒç¶šå¯èƒ½æ€§**: é•·æœŸçš„ã«ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã‚„ã™ã„ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®æ§‹ç¯‰

### 5.1. é‡è¦ãªåŸå‰‡

ä»¥ä¸‹ã®åŸå‰‡ã¯ã€ã™ã¹ã¦ã®æŠ€è¡“çš„åˆ¤æ–­ã®åŸºç›¤ã¨ãªã‚Šã¾ã™ï¼š

1. **ã‚·ãƒ³ãƒ—ãƒ«ã•ã‚’å„ªå…ˆ** - è¤‡é›‘ã•ã‚ˆã‚Šã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã•ã‚’é¸ã¶
2. **ä¸€è²«æ€§ã‚’ç¶­æŒ** - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§çµ±ä¸€ã•ã‚ŒãŸã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä¿ã¤
3. **ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å¤§åˆ‡ã«** - å»ºè¨­çš„ãªè­°è«–ã§å“è³ªã‚’å‘ä¸Š
4. **ç¶™ç¶šçš„æ”¹å–„** - å°ã•ãªæ”¹å–„ã‚’ç©ã¿é‡ã­ã‚‹
5. **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å…¥ã‚Œã€å…·è±¡ã‚’è¿”ã™** - Goã®è¨­è¨ˆæ€æƒ³ã«å¾“ã„ã€æŸ”è»Ÿã§ä¿å®ˆæ€§ã®é«˜ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã

#### ğŸ¯ Goè¨­è¨ˆæ€æƒ³ï¼šã€Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å…¥ã‚Œã€å…·è±¡ï¼ˆstructï¼‰ã‚’è¿”ã™ã€

ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚„ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼é–¢æ•°ã‚’è¨­è¨ˆã™ã‚‹éš›ã®é‡è¦ãªåŸå‰‡ï¼š

**âœ… æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š**

```go
// ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å–ã‚Šã€å…·è±¡å‹ã‚’è¿”ã™
func NewProductServiceImpl(
    repo ProductRepository,  // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å…¥ã‚Œã‚‹
    logger *slog.Logger,
) *ProductServiceImpl {      // å…·è±¡å‹ã‚’è¿”ã™
    return &ProductServiceImpl{
        repo:   repo,
        logger: logger,
    }
}
```

**âŒ éæ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š**

```go
// ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¿”ã™ã¨å‘¼ã³å‡ºã—å´ã®æŸ”è»Ÿæ€§ãŒå¤±ã‚ã‚Œã‚‹
func NewProductService(
    repo ProductRepository,
    logger *slog.Logger,
) ProductService {  // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¿”ã™ï¼ˆæ¨å¥¨ã•ã‚Œãªã„ï¼‰
    return &ProductServiceImpl{
        repo:   repo,
        logger: logger,
    }
}
```

**ã“ã®åŸå‰‡ã®åˆ©ç‚¹ï¼š**

- **å‘¼ã³å‡ºã—å´ã®è‡ªç”±åº¦**: å…·è±¡å‹ã‚’å—ã‘å–ã‚Šã€å¿…è¦ã«å¿œã˜ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã—ã¦æ‰±ãˆã‚‹
- **å®Ÿè£…ã®æ˜ç¢ºæ€§**: ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿åï¼ˆ`NewXxxImpl`ï¼‰ã§å…·è±¡å‹ã‚’è¿”ã™ã“ã¨ãŒæ˜ç¤ºã•ã‚Œã‚‹
- **DIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã®è¦ªå’Œæ€§**: Uber Fxã®`fx.As`ã§ç°¡å˜ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å¤‰æ›ã§ãã‚‹
- **ãƒ‡ãƒãƒƒã‚°ã®å®¹æ˜“æ€§**: å®Ÿéš›ã®å‹æƒ…å ±ãŒä¿æŒã•ã‚Œã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒå®¹æ˜“

> ğŸ’¡ **Geminiå‘ã‘ã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰**  
> ã‚³ãƒ¼ãƒ‰ç”Ÿæˆæ™‚ã¯ã€å¿…ãšã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿åã«`Impl`ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä»˜ã‘ï¼ˆä¾‹ï¼š`NewProductServiceImpl`ï¼‰ã€å…·è±¡å‹ï¼ˆä¾‹ï¼š`*ProductServiceImpl`ï¼‰ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚Fxãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã¯`fx.Annotate`ã¨`fx.As`ã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å¤‰æ›ã—ã¾ã™ã€‚

### 5.2. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### ğŸ“„ ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚

- [ ] æ­£ç¢ºæ€§: ä»•æ§˜ã‚’æº€ãŸã—ã€ãƒã‚°ãŒãªã„ã‹ï¼Ÿ
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: è„†å¼±æ€§ã‚„å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ¼ã‚Œã¯ãªã„ã‹ï¼Ÿ
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: N+1å•é¡Œã‚„ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã¯ãªã„ã‹ï¼Ÿ
- [ ] ãƒ†ã‚¹ãƒˆ: ååˆ†ãªãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒã‚ã‚‹ã‹ï¼Ÿ
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: ã‚³ãƒ¡ãƒ³ãƒˆã‚„READMEãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] è¨­è¨ˆ: ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ã€Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å—ã‘å…¥ã‚Œã€å…·è±¡ã‚’è¿”ã™ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã£ã¦ã„ã‚‹ã‹ï¼Ÿ

#### ğŸ”§ ãƒªãƒªãƒ¼ã‚¹å‰

- [ ] CI/CD: ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] API: ç ´å£Šçš„å¤‰æ›´ãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã‹ï¼Ÿ
- [ ] ãƒ­ã‚°: ç·åˆãƒ†ã‚¹ãƒˆã§ãƒ­ã‚°å‡ºåŠ›ã‚’ç¢ºèªã—ãŸã‹ï¼Ÿ
- [ ] ãƒ¡ãƒˆãƒªã‚¯ã‚¹: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç¢ºèªã—ãŸã‹ï¼Ÿ

### 5.3. å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

#### ğŸ“š Goè¨€èªã®åŸºç¤ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

- [Effective Go](https://golang.org/doc/effective_go) - Goè¨€èªã®å…¬å¼ã‚¬ã‚¤ãƒ‰
- [Go Code Review Comments](https://github.com/golang/go/wiki/CodeReviewComments) - Goã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### ğŸ”Œ gRPCã¨Protocol Buffers

- [Connect-Go Documentation](https://connectrpc.com/docs/go/getting-started) - Connect-Goã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [Buf Documentation](https://buf.build/docs) - Bufãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [Google API Design Guide](https://cloud.google.com/apis/design) - Googleã®APIè¨­è¨ˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

#### ğŸ’‰ ä¾å­˜æ€§æ³¨å…¥ï¼ˆDIï¼‰

> âš ï¸ **é‡è¦**: ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯**Uber Fx**ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™

- [Uber Fx Documentation](https://uber-go.github.io/fx/) - Uber Fxã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [Fx Modules Guide](https://uber-go.github.io/fx/modules.html) - Fxãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³
- [Fx Annotate API](https://pkg.go.dev/go.uber.org/fx#Annotate) - fx.Annotateã®ä½¿ç”¨æ–¹æ³•

#### ğŸ§ª ãƒ†ã‚¹ãƒ†ã‚£ãƒ³ã‚°

- [Ginkgo](https://onsi.github.io/ginkgo/) - BDDã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- [Gomega](https://onsi.github.io/gomega/) - ãƒãƒƒãƒãƒ£ãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- [gomock](https://github.com/golang/mock) - ãƒ¢ãƒƒã‚¯ç”Ÿæˆãƒ„ãƒ¼ãƒ«

## 6. DDD

```mermaid
graph TD
    %% ãƒ¬ã‚¤ãƒ¤ãƒ¼å®šç¾© %%
    subgraph "UIå±¤ (Presentation Layer)"
        Controller["Controller / Presenter"]
    end

    subgraph "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ (Application Layer)"
        AppService["Application Service / Use Case"]
        DTO["Data Transfer Object (DTO)"]
    end

    subgraph "<b>ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ (Domain Layer) âœ¨</b>"
        direction LR
        Factory["<b>Factory</b>"]
        Aggregate["Entity / Aggregate"]
        ValueObject["<b>Value Object</b>"]
        RepoInterface["Repository <b>Interface</b>"]
        DomainService["Domain Service"]
    end

    subgraph "ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ (Infrastructure Layer)"
        RepoImpl["Repository <b>Implementation</b>"]
        InfraService["DB / Cache / API Client"]
    end

    %% ä¾å­˜é–¢ä¿‚ %%
    Controller -- "DTOã‚’æ¸¡ã—ã¦å‘¼ã³å‡ºã—" --> AppService
    AppService -- "DTOã«å¤‰æ›ã—ã¦è¿”ã™" --> Controller

    AppService -- "åˆ©ç”¨" --> RepoInterface
    AppService -- "åˆ©ç”¨" --> Factory
    AppService -- "åˆ©ç”¨" --> DomainService

    Aggregate -- "æ§‹æˆè¦ç´ ã¨ã—ã¦åˆ©ç”¨" --> ValueObject
    Factory -- "ç”Ÿæˆ" --> Aggregate

    RepoImpl -- "<b>å®Ÿè£…</b>" --> RepoInterface
    RepoImpl -- "åˆ©ç”¨" --> InfraService
```

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®é•ã„

#### ğŸ›ï¸ 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ (æŒ‡æ®è€…)

\*\*ã€Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿç¾ã€**ãŒè²¬å‹™ã§ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆUIå±¤ï¼‰ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€ãã®**ã‚¿ã‚¹ã‚¯ã‚’å®Œäº†ã•ã›ã‚‹ã¾ã§ã®å…¨å·¥ç¨‹ã‚’æŒ‡æ®ï¼ˆã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰\*\*ã—ã¾ã™ã€‚

- **è²¬å‹™:**

  - ãƒªãƒã‚¸ãƒˆãƒªã‚’å‘¼ã³å‡ºã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ã®**å­˜åœ¨ãƒã‚§ãƒƒã‚¯**ã‚’ã—ãŸã‚Šã€ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ãŸã‚Šã—ã¾ã™ã€‚ï¼ˆä¾‹: `userRepository.exists(id)`)
  - ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ç”Ÿæˆï¼ˆ`new User(...)`ï¼‰ã—ãŸã‚Šã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆ`order.cancel()`ï¼‰ã‚’å‘¼ã³å‡ºã—ãŸã‚Šã—ã¾ã™ã€‚
  - å¿…è¦ã§ã‚ã‚Œã°ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ`transferService.transfer(...)`ï¼‰ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚
  - ãƒªãƒã‚¸ãƒˆãƒªã‚’å‘¼ã³å‡ºã—ã¦ã€çµæœã‚’DBã«ä¿å­˜ï¼ˆ`userRepository.save(user)`ï¼‰ã—ã¾ã™ã€‚
  - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ç®¡ç†ã‚„ã€ãƒ­ã‚°å‡ºåŠ›ãªã©ã‚‚æ‹…å½“ã—ã¾ã™ã€‚

- **Goã§ã®å®Ÿè£…:** ãƒªãƒã‚¸ãƒˆãƒªç­‰ã®**ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**ã«ä¾å­˜ã—ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å˜ä½ã®å…¬é–‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¡ã¾ã™ã€‚

```go
package application

import "example.com/domain"

// IOrderRepository ã¯ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
type IOrderRepository interface {
 FindById(id int) (*domain.Order, error)
 Save(order *domain.Order) error
}

// OrderApplicationService ã¯ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’å®Ÿè£…
type OrderApplicationService struct {
 orderRepo IOrderRepository
}

func NewOrderApplicationService(repo IOrderRepository) *OrderApplicationService {
 return &OrderApplicationService{orderRepo: repo}
}

// CancelOrder ã¯ã€Œæ³¨æ–‡ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
func (s *OrderApplicationService) CancelOrder(orderID int) error {
 // 1. ãƒªãƒã‚¸ãƒˆãƒªã§ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å–å¾—
 order, err := s.orderRepo.FindById(orderID)
 if err != nil {
  return err
 }

 // 2. ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ï¼‰ã‚’å‘¼ã³å‡ºã™
 if err := order.Cancel(); err != nil {
  return err
 }

 // 3. ãƒªãƒã‚¸ãƒˆãƒªã§ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä¿å­˜
 if err := s.orderRepo.Save(order); err != nil {
  return err
 }
 return nil
}
```

#### ğŸ›¡ï¸ 2. ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ (å°‚é–€å®¶)

\*\*ã€Œè¤‡æ•°ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¾ãŸãŒã‚‹ã€ç´”ç²‹ãªãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã€\*\*ãŒè²¬å‹™ã§ã™ã€‚
ç‰¹å®šã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£1ã¤ã®è²¬å‹™ã¨ã¯è¨€ãˆãªã„ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ ¸ã¨ãªã‚‹è¤‡é›‘ãªè¨ˆç®—ã‚„èª¿æ•´ã‚’è¡Œã„ã¾ã™ã€‚

- **è²¬å‹™:** è¤‡æ•°ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¼•æ•°ã§å—ã‘å–ã‚Šã€ãã‚Œã‚‰ã‚’æ“ä½œã—ã¦ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã€‚**çŠ¶æ…‹ã‚’æŒãŸãªã„ï¼ˆã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ï¼‰**ã€‚
- **Goã§ã®å®Ÿè£…:** é€šå¸¸ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒãŸãªã„structã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¾ã™ã€‚

```go
package domain

// MoneyTransferService (æŒ¯è¾¼ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹)
type MoneyTransferService struct{}

func NewMoneyTransferService() *MoneyTransferService {
 return &MoneyTransferService{}
}

// Transfer ã¯ã€ŒAå£åº§ã€ã¨ã€ŒBå£åº§ã€ã¨ã„ã†2ã¤ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å¼•æ•°ã§å—ã‘å–ã‚‹
func (s *MoneyTransferService) Transfer(from *Account, to *Account, amount int) error {
 // å„ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™
 if err := from.Withdraw(amount); err != nil {
  return err
 }
 if err := to.Deposit(amount); err != nil {
  return err
 }
 return nil
}
```

#### ğŸ‘¤ 3. ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ¡ã‚½ãƒƒãƒ‰ (å½“äº‹è€…)

\*\*ã€Œè‡ªåˆ†è‡ªèº«ã®çŠ¶æ…‹ï¼ˆãƒ‡ãƒ¼ã‚¿ï¼‰ã«åŸºã¥ã„ãŸã€è‡ªåˆ†è‡ªèº«ã§å®Œçµã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã€\*\*ãŒè²¬å‹™ã§ã™ã€‚
ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯ã€Œãƒ‡ãƒ¼ã‚¿ã¨æŒ¯ã‚‹èˆã„ã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã§ã™ã€‚

- **è²¬å‹™:** ãƒ‡ãƒ¼ã‚¿ã®ã‚«ãƒ—ã‚»ãƒ«åŒ–ã€‚è‡ªèº«ã®çŠ¶æ…‹æ•´åˆæ€§ã‚’ä¿ã¤ã“ã¨ã€‚
- **Goã§ã®å®Ÿè£…:** çŠ¶æ…‹ï¼ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰ã‚’**éå…¬é–‹**ï¼ˆå°æ–‡å­—å§‹ã¾ã‚Šï¼‰ã«ã—ã€çŠ¶æ…‹ã‚’å¤‰æ›´ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãƒ¡ã‚½ãƒƒãƒ‰ï¼‰ã‚’**å…¬é–‹**ï¼ˆå¤§æ–‡å­—å§‹ã¾ã‚Šï¼‰ã«ã—ã¾ã™ã€‚

```go
package domain

import "errors"

// Order (æ³¨æ–‡) ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
type Order struct {
 id     int
 status string // éå…¬é–‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
}

// Cancel ã¯ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£è‡ªèº«ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæŒ¯ã‚‹èˆã„ï¼‰
func (o *Order) Cancel() error {
 if o.status == "SHIPPED" {
  return errors.New("ç™ºé€æ¸ˆã¿ã®æ³¨æ–‡ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ãã¾ã›ã‚“")
 }
 o.status = "CANCELLED" // è‡ªåˆ†ã®çŠ¶æ…‹ã‚’è‡ªåˆ†ã§å¤‰æ›´
 return nil
}
```

#### ğŸš¨ å±é™ºä¿¡å· (ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³)

- **Appã‚µãƒ¼ãƒ“ã‚¹ãŒã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ãï¼ˆè²§è¡€ç—‡ï¼‰:**
    `if order.Status() == "SHIPPED"` ã®ã‚ˆã†ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’Appã‚µãƒ¼ãƒ“ã‚¹ã«æ›¸ãã®ã¯NGã§ã™ã€‚`order.Cancel()`ã‚’å‘¼ã³å‡ºã™ã ã‘ã«ã—ã¾ã™ã€‚
- **ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ãŒãƒªãƒã‚¸ãƒˆãƒªã‚’æ“ä½œã™ã‚‹:**
    ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ãŒãƒªãƒã‚¸ãƒˆãƒªï¼ˆDBï¼‰ã«ä¾å­˜ã™ã‚‹ã®ã¯NGã§ã™ã€‚Appã‚µãƒ¼ãƒ“ã‚¹ãŒã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å–å¾—ã—ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã«æ¸¡ã™ã¹ãã§ã™ã€‚

#### æ¯”è¼ƒã¾ã¨ã‚è¡¨

| æ¯”è¼ƒé …ç›® | ğŸ‘¤ ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ¡ã‚½ãƒƒãƒ‰ | ğŸ›¡ï¸ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ | ğŸ›ï¸ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ |
| :--- | :--- | :--- | :--- |
| **æ‰€å±ãƒ¬ã‚¤ãƒ¤ãƒ¼** | **ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤** (ä¸­æ ¸) | **ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤** | **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤** |
| **ä¸»ãªå½¹å‰²** | **å½“äº‹è€…**ï¼ˆè‡ªèº«ã®çŠ¶æ…‹ç®¡ç†ï¼‰ | **å°‚é–€å®¶**ï¼ˆè¤‡æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé–“ã®ãƒ«ãƒ¼ãƒ«ï¼‰ | **æŒ‡æ®è€…**ï¼ˆãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œï¼‰ |
| **è²¬å‹™ç¯„å›²** | **è‡ªåˆ†è‡ªèº«**ã®çŠ¶æ…‹ã ã‘ã§å®Œçµã™ã‚‹ç¯„å›² | **è¤‡æ•°**ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¾ãŸãŒã‚‹ç¯„å›² | 1ã¤ã®**ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹**ã®æœ€åˆã‹ã‚‰æœ€å¾Œã¾ã§ |
| **çŠ¶æ…‹ã®æœ‰ç„¡** | **çŠ¶æ…‹ã‚’æŒã¤ (Stateful)** | **çŠ¶æ…‹ã‚’æŒãŸãªã„ (Stateless)** | çŠ¶æ…‹ã‚’æŒãŸãªã„ (Stateless) |
| **ãƒªãƒã‚¸ãƒˆãƒªæ“ä½œ** | **çµ¶å¯¾ã«ã—ãªã„** | **åŸå‰‡ã—ãªã„**ï¼ˆAppã‹ã‚‰æ¸¡ã•ã‚Œã‚‹ï¼‰ | **ç©æ¥µçš„ã«è¡Œã†**ï¼ˆå–å¾—ãƒ»ä¿å­˜ï¼‰ |
| **ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³** | â€• | ãƒªãƒã‚¸ãƒˆãƒªã‚’æ“ä½œã™ã‚‹ | ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ãï¼ˆè²§è¡€ç—‡ï¼‰ |

### DDDã«ãŠã‘ã‚‹DTOã®å½¹å‰²

DDDã«ãŠã‘ã‚‹\*\*DTOï¼ˆData Transfer Objectï¼‰\*\*ã®ä¸»ãªå½¹å‰²ã¯ã€**ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã€ç‰¹ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã¨UIå±¤ï¼ˆã¾ãŸã¯å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã®é–“ã§ã€ãƒ‡ãƒ¼ã‚¿ã‚’è»¢é€ã™ã‚‹ãŸã‚ã ã‘ã®å…¥ã‚Œç‰©**ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ã“ã¨ã§ã™ã€‚

æœ€ã‚‚é‡è¦ãªç›®çš„ã¯ã€**ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ï¼ˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãªã©ï¼‰ã‚’å¤–éƒ¨ã«æ¼ã‚‰ã•ãšã€ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ã‚«ãƒ—ã‚»ãƒ«åŒ–ã‚’å®ˆã‚‹**ã“ã¨ã§ã™ã€‚

#### DTOã®å…·ä½“çš„ãªå½¹å‰²ã¨å¿…è¦æ€§

##### 1\. ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®éš è”½ï¼ˆã‚«ãƒ—ã‚»ãƒ«åŒ–ã®ä¿è­·ï¼‰

ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’UIå±¤ãªã©ã®å¤–éƒ¨ã«ç›´æ¥æ¸¡ã—ã¦ã—ã¾ã†ã¨ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚„è¤‡é›‘ãªå†…éƒ¨æ§‹é€ ãŒå¤–éƒ¨ã«å…¬é–‹ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚DTOã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ãŒãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’**UIå±¤ãŒå¿…è¦ã¨ã™ã‚‹å˜ç´”ãªãƒ‡ãƒ¼ã‚¿**ã«è©°ã‚æ›¿ãˆã‚‹ã“ã¨ã§ã€ã“ã‚Œã‚’é˜²ãã¾ã™ã€‚

##### 2\. UIå±¤ã«æœ€é©åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®æä¾›

ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®æ§‹é€ ã¯ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã«æœ€é©åŒ–ã•ã‚Œã¦ã„ã¾ã™ãŒã€UIï¼ˆç”»é¢ï¼‰ãŒè¡¨ç¤ºã—ãŸã„ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨ã¯ç•°ãªã‚‹ã“ã¨ãŒã‚ˆãã‚ã‚Šã¾ã™ã€‚DTOã¯ã€**UIãŒã€Œæ¬²ã—ã„å½¢ã€ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢ã—ã¦æä¾›ã™ã‚‹**å½¹å‰²ã‚’æ‹…ã„ã¾ã™ã€‚

##### 3\. ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒãŸãªã„ã€Œãƒ‡ãƒ¼ã‚¿ã®å…¥ã‚Œç‰©ã€

DTOã¯ã€**ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãƒ¡ã‚½ãƒƒãƒ‰ï¼‰ã‚’ä¸€åˆ‡æŒã¡ã¾ã›ã‚“**ã€‚ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ãã®ã‚¢ã‚¯ã‚»ã‚µï¼ˆgetter/setterãªã©ï¼‰ã®ã¿ã§æ§‹æˆã•ã‚Œã€ã€Œå˜ãªã‚‹ãƒ‡ãƒ¼ã‚¿è»¢é€ç”¨ã®ç®±ã€ã¨ã„ã†å½¹å‰²ã«å¾¹ã—ã¾ã™ã€‚

## DTOãŒä½¿ã‚ã‚Œã‚‹å…¸å‹çš„ãªæµã‚Œ

```mermaid
graph TD
    A["UIå±¤ (Controller)"]

    subgraph "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤"
        B["Application Service"]
        E["Data Transfer Object (DTO)"]
    end

    C["ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ (Repository / Entity)"]

    A -- "1. ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (Input DTO)" --> B
    B -- "2. ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã‚’åˆ©ç”¨" --> C
    B -- "3. ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’DTOã«å¤‰æ›" --> E
    B -- "4. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ (Output DTO)" --> A
```

1. **UIå±¤ â†’ Appå±¤:** UIå±¤ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’DTOã«è©°ã‚ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã«æ¸¡ã—ã¾ã™ã€‚
2. **Appå±¤ â†’ UIå±¤:** ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã§å‡¦ç†ã‚’è¡Œã£ãŸçµæœï¼ˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãªã©ï¼‰ã‚’ã€UIå±¤ãŒæ‰±ã„ã‚„ã™ã„DTOã«**è©°ã‚æ›¿ãˆã¦**è¿”ã—ã¾ã™ã€‚

DTOã¯ã€ã“ã®ã‚ˆã†ã«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¢ƒç•Œç·šã‚’è¶Šãˆã‚‹éš›ã«ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ç´”ç²‹æ€§ã‚’å®ˆã‚‹ãŸã‚ã®é‡è¦ãª**ç·©è¡æ**ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚
